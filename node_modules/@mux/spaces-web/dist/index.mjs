"use strict";var Ws=Object.create;var ir=Object.defineProperty;var Js=Object.getOwnPropertyDescriptor;var Ks=Object.getOwnPropertyNames;var Xs=Object.getPrototypeOf,Qs=Object.prototype.hasOwnProperty;var s=(t,e)=>ir(t,"name",{value:e,configurable:!0});var Oi=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Xe=(t,e)=>{for(var r in e)ir(t,r,{get:e[r],enumerable:!0})},Zs=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ks(e))!Qs.call(t,i)&&i!==r&&ir(t,i,{get:()=>e[i],enumerable:!(n=Js(e,i))||n.enumerable});return t};var ue=(t,e,r)=>(r=t!=null?Ws(Xs(t)):{},Zs(e||!t||!t.__esModule?ir(r,"default",{value:t,enumerable:!0}):r,t));var Pn=Oi((Gu,xn)=>{"use strict";var m={};m.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};m.localCName=m.generateIdentifier();m.splitLines=function(t){return t.trim().split(`
`).map(e=>e.trim())};m.splitSections=function(t){return t.split(`
m=`).map((r,n)=>(n>0?"m="+r:r).trim()+`\r
`)};m.getDescription=function(t){let e=m.splitSections(t);return e&&e[0]};m.getMediaSections=function(t){let e=m.splitSections(t);return e.shift(),e};m.matchPrefix=function(t,e){return m.splitLines(t).filter(r=>r.indexOf(e)===0)};m.parseCandidate=function(t){let e;t.indexOf("a=candidate:")===0?e=t.substring(12).split(" "):e=t.substring(10).split(" ");let r={foundation:e[0],component:{1:"rtp",2:"rtcp"}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]};for(let n=8;n<e.length;n+=2)switch(e[n]){case"raddr":r.relatedAddress=e[n+1];break;case"rport":r.relatedPort=parseInt(e[n+1],10);break;case"tcptype":r.tcpType=e[n+1];break;case"ufrag":r.ufrag=e[n+1],r.usernameFragment=e[n+1];break;default:r[e[n]]===void 0&&(r[e[n]]=e[n+1]);break}return r};m.writeCandidate=function(t){let e=[];e.push(t.foundation);let r=t.component;r==="rtp"?e.push(1):r==="rtcp"?e.push(2):e.push(r),e.push(t.protocol.toUpperCase()),e.push(t.priority),e.push(t.address||t.ip),e.push(t.port);let n=t.type;return e.push("typ"),e.push(n),n!=="host"&&t.relatedAddress&&t.relatedPort&&(e.push("raddr"),e.push(t.relatedAddress),e.push("rport"),e.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(e.push("tcptype"),e.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(e.push("ufrag"),e.push(t.usernameFragment||t.ufrag)),"candidate:"+e.join(" ")};m.parseIceOptions=function(t){return t.substr(14).split(" ")};m.parseRtpMap=function(t){let e=t.substr(9).split(" "),r={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),r.name=e[0],r.clockRate=parseInt(e[1],10),r.channels=e.length===3?parseInt(e[2],10):1,r.numChannels=r.channels,r};m.writeRtpMap=function(t){let e=t.payloadType;t.preferredPayloadType!==void 0&&(e=t.preferredPayloadType);let r=t.channels||t.numChannels||1;return"a=rtpmap:"+e+" "+t.name+"/"+t.clockRate+(r!==1?"/"+r:"")+`\r
`};m.parseExtmap=function(t){let e=t.substr(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1]}};m.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+`\r
`};m.parseFmtp=function(t){let e={},r,n=t.substr(t.indexOf(" ")+1).split(";");for(let i=0;i<n.length;i++)r=n[i].trim().split("="),e[r[0].trim()]=r[1];return e};m.writeFmtp=function(t){let e="",r=t.payloadType;if(t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){let n=[];Object.keys(t.parameters).forEach(i=>{t.parameters[i]!==void 0?n.push(i+"="+t.parameters[i]):n.push(i)}),e+="a=fmtp:"+r+" "+n.join(";")+`\r
`}return e};m.parseRtcpFb=function(t){let e=t.substr(t.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}};m.writeRtcpFb=function(t){let e="",r=t.payloadType;return t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(n=>{e+="a=rtcp-fb:"+r+" "+n.type+(n.parameter&&n.parameter.length?" "+n.parameter:"")+`\r
`}),e};m.parseSsrcMedia=function(t){let e=t.indexOf(" "),r={ssrc:parseInt(t.substr(7,e-7),10)},n=t.indexOf(":",e);return n>-1?(r.attribute=t.substr(e+1,n-e-1),r.value=t.substr(n+1)):r.attribute=t.substr(e+1),r};m.parseSsrcGroup=function(t){let e=t.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(r=>parseInt(r,10))}};m.getMid=function(t){let e=m.matchPrefix(t,"a=mid:")[0];if(e)return e.substr(6)};m.parseFingerprint=function(t){let e=t.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}};m.getDtlsParameters=function(t,e){let r=m.matchPrefix(t+e,"a=fingerprint:");return{role:"auto",fingerprints:r.map(m.parseFingerprint)}};m.writeDtlsParameters=function(t,e){let r="a=setup:"+e+`\r
`;return t.fingerprints.forEach(n=>{r+="a=fingerprint:"+n.algorithm+" "+n.value+`\r
`}),r};m.parseCryptoLine=function(t){let e=t.substr(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}};m.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?m.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`};m.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;let e=t.substr(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}};m.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")};m.getCryptoParameters=function(t,e){return m.matchPrefix(t+e,"a=crypto:").map(m.parseCryptoLine)};m.getIceParameters=function(t,e){let r=m.matchPrefix(t+e,"a=ice-ufrag:")[0],n=m.matchPrefix(t+e,"a=ice-pwd:")[0];return r&&n?{usernameFragment:r.substr(12),password:n.substr(10)}:null};m.writeIceParameters=function(t){let e="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(e+=`a=ice-lite\r
`),e};m.parseRtpParameters=function(t){let e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=m.splitLines(t)[0].split(" ");for(let i=3;i<n.length;i++){let a=n[i],o=m.matchPrefix(t,"a=rtpmap:"+a+" ")[0];if(o){let c=m.parseRtpMap(o),u=m.matchPrefix(t,"a=fmtp:"+a+" ");switch(c.parameters=u.length?m.parseFmtp(u[0]):{},c.rtcpFeedback=m.matchPrefix(t,"a=rtcp-fb:"+a+" ").map(m.parseRtcpFb),e.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(c.name.toUpperCase());break;default:break}}}return m.matchPrefix(t,"a=extmap:").forEach(i=>{e.headerExtensions.push(m.parseExtmap(i))}),e};m.writeRtpDescription=function(t,e){let r="";r+="m="+t+" ",r+=e.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=e.codecs.map(i=>i.preferredPayloadType!==void 0?i.preferredPayloadType:i.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,e.codecs.forEach(i=>{r+=m.writeRtpMap(i),r+=m.writeFmtp(i),r+=m.writeRtcpFb(i)});let n=0;return e.codecs.forEach(i=>{i.maxptime>n&&(n=i.maxptime)}),n>0&&(r+="a=maxptime:"+n+`\r
`),e.headerExtensions&&e.headerExtensions.forEach(i=>{r+=m.writeExtmap(i)}),r};m.parseRtpEncodingParameters=function(t){let e=[],r=m.parseRtpParameters(t),n=r.fecMechanisms.indexOf("RED")!==-1,i=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=m.matchPrefix(t,"a=ssrc:").map(p=>m.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),o=a.length>0&&a[0].ssrc,c,u=m.matchPrefix(t,"a=ssrc-group:FID").map(p=>p.substr(17).split(" ").map(h=>parseInt(h,10)));u.length>0&&u[0].length>1&&u[0][0]===o&&(c=u[0][1]),r.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let f={ssrc:o,codecPayloadType:parseInt(p.parameters.apt,10)};o&&c&&(f.rtx={ssrc:c}),e.push(f),n&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:o,mechanism:i?"red+ulpfec":"red"},e.push(f))}}),e.length===0&&o&&e.push({ssrc:o});let d=m.matchPrefix(t,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substr(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substr(5),10)*1e3*.95-50*40*8:d=void 0,e.forEach(p=>{p.maxBitrate=d})),e};m.parseRtcpParameters=function(t){let e={},r=m.matchPrefix(t,"a=ssrc:").map(a=>m.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(e.cname=r.value,e.ssrc=r.ssrc);let n=m.matchPrefix(t,"a=rtcp-rsize");e.reducedSize=n.length>0,e.compound=n.length===0;let i=m.matchPrefix(t,"a=rtcp-mux");return e.mux=i.length>0,e};m.writeRtcpParameters=function(t){let e="";return t.reducedSize&&(e+=`a=rtcp-rsize\r
`),t.mux&&(e+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(e+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),e};m.parseMsid=function(t){let e,r=m.matchPrefix(t,"a=msid:");if(r.length===1)return e=r[0].substr(7).split(" "),{stream:e[0],track:e[1]};let n=m.matchPrefix(t,"a=ssrc:").map(i=>m.parseSsrcMedia(i)).filter(i=>i.attribute==="msid");if(n.length>0)return e=n[0].value.split(" "),{stream:e[0],track:e[1]}};m.parseSctpDescription=function(t){let e=m.parseMLine(t),r=m.matchPrefix(t,"a=max-message-size:"),n;r.length>0&&(n=parseInt(r[0].substr(19),10)),isNaN(n)&&(n=65536);let i=m.matchPrefix(t,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:e.fmt,maxMessageSize:n};let a=m.matchPrefix(t,"a=sctpmap:");if(a.length>0){let o=a[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:n}}};m.writeSctpDescription=function(t,e){let r=[];return t.protocol!=="DTLS/SCTP"?r=["m="+t.kind+" 9 "+t.protocol+" "+e.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+e.port+`\r
`]:r=["m="+t.kind+" 9 "+t.protocol+" "+e.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+e.port+" "+e.protocol+` 65535\r
`],e.maxMessageSize!==void 0&&r.push("a=max-message-size:"+e.maxMessageSize+`\r
`),r.join("")};m.generateSessionId=function(){return Math.random().toString().substr(2,21)};m.writeSessionBoilerplate=function(t,e,r){let n,i=e!==void 0?e:2;return t?n=t:n=m.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+n+" "+i+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`};m.getDirection=function(t,e){let r=m.splitLines(t);for(let n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2);default:}return e?m.getDirection(e):"sendrecv"};m.getKind=function(t){return m.splitLines(t)[0].split(" ")[0].substr(2)};m.isRejected=function(t){return t.split(" ",2)[1]==="0"};m.parseMLine=function(t){let r=m.splitLines(t)[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}};m.parseOLine=function(t){let r=m.matchPrefix(t,"o=")[0].substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}};m.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;let e=m.splitLines(t);for(let r=0;r<e.length;r++)if(e[r].length<2||e[r].charAt(1)!=="=")return!1;return!0};typeof xn=="object"&&(xn.exports=m)});var Ee=Oi((Yu,Dn)=>{"use strict";var Ze=typeof Reflect=="object"?Reflect:null,Hi=Ze&&typeof Ze.apply=="function"?Ze.apply:s(function(e,r,n){return Function.prototype.apply.call(e,r,n)},"ReflectApply"),hr;Ze&&typeof Ze.ownKeys=="function"?hr=Ze.ownKeys:Object.getOwnPropertySymbols?hr=s(function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))},"ReflectOwnKeys"):hr=s(function(e){return Object.getOwnPropertyNames(e)},"ReflectOwnKeys");function to(t){console&&console.warn&&console.warn(t)}s(to,"ProcessEmitWarning");var zi=Number.isNaN||s(function(e){return e!==e},"NumberIsNaN");function T(){T.init.call(this)}s(T,"EventEmitter");Dn.exports=T;Dn.exports.once=ao;T.EventEmitter=T;T.prototype._events=void 0;T.prototype._eventsCount=0;T.prototype._maxListeners=void 0;var qi=10;function gr(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}s(gr,"checkListener");Object.defineProperty(T,"defaultMaxListeners",{enumerable:!0,get:function(){return qi},set:function(t){if(typeof t!="number"||t<0||zi(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");qi=t}});T.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};T.prototype.setMaxListeners=s(function(e){if(typeof e!="number"||e<0||zi(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},"setMaxListeners");function Vi(t){return t._maxListeners===void 0?T.defaultMaxListeners:t._maxListeners}s(Vi,"_getMaxListeners");T.prototype.getMaxListeners=s(function(){return Vi(this)},"getMaxListeners");T.prototype.emit=s(function(e){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i=e==="error",a=this._events;if(a!==void 0)i=i&&a.error===void 0;else if(!i)return!1;if(i){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var c=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw c.context=o,c}var u=a[e];if(u===void 0)return!1;if(typeof u=="function")Hi(u,this,r);else for(var d=u.length,p=Qi(u,d),n=0;n<d;++n)Hi(p[n],this,r);return!0},"emit");function Wi(t,e,r,n){var i,a,o;if(gr(r),a=t._events,a===void 0?(a=t._events=Object.create(null),t._eventsCount=0):(a.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),a=t._events),o=a[e]),o===void 0)o=a[e]=r,++t._eventsCount;else if(typeof o=="function"?o=a[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),i=Vi(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=o.length,to(c)}return t}s(Wi,"_addListener");T.prototype.addListener=s(function(e,r){return Wi(this,e,r,!1)},"addListener");T.prototype.on=T.prototype.addListener;T.prototype.prependListener=s(function(e,r){return Wi(this,e,r,!0)},"prependListener");function ro(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}s(ro,"onceWrapper");function Ji(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=ro.bind(n);return i.listener=r,n.wrapFn=i,i}s(Ji,"_onceWrap");T.prototype.once=s(function(e,r){return gr(r),this.on(e,Ji(this,e,r)),this},"once");T.prototype.prependOnceListener=s(function(e,r){return gr(r),this.prependListener(e,Ji(this,e,r)),this},"prependOnceListener");T.prototype.removeListener=s(function(e,r){var n,i,a,o,c;if(gr(r),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||r));else if(typeof n!="function"){for(a=-1,o=n.length-1;o>=0;o--)if(n[o]===r||n[o].listener===r){c=n[o].listener,a=o;break}if(a<0)return this;a===0?n.shift():no(n,a),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,c||r)}return this},"removeListener");T.prototype.off=T.prototype.removeListener;T.prototype.removeAllListeners=s(function(e){var r,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var a=Object.keys(n),o;for(i=0;i<a.length;++i)o=a[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(i=r.length-1;i>=0;i--)this.removeListener(e,r[i]);return this},"removeAllListeners");function Ki(t,e,r){var n=t._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?io(i):Qi(i,i.length)}s(Ki,"_listeners");T.prototype.listeners=s(function(e){return Ki(this,e,!0)},"listeners");T.prototype.rawListeners=s(function(e){return Ki(this,e,!1)},"rawListeners");T.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Xi.call(t,e)};T.prototype.listenerCount=Xi;function Xi(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}s(Xi,"listenerCount");T.prototype.eventNames=s(function(){return this._eventsCount>0?hr(this._events):[]},"eventNames");function Qi(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}s(Qi,"arrayClone");function no(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}s(no,"spliceOne");function io(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}s(io,"unwrapListeners");function ao(t,e){return new Promise(function(r,n){function i(o){t.removeListener(e,a),n(o)}s(i,"errorListener");function a(){typeof t.removeListener=="function"&&t.removeListener("error",i),r([].slice.call(arguments))}s(a,"resolver"),Zi(t,e,a,{once:!0}),e!=="error"&&so(t,i,{once:!0})})}s(ao,"once");function so(t,e,r){typeof t.on=="function"&&Zi(t,"error",e,r)}s(so,"addErrorHandlerIfEventEmitter");function Zi(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,s(function i(a){n.once&&t.removeEventListener(e,i),r(a)},"wrapListener"));else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}s(Zi,"eventTargetAgnosticAddListener")});var Ni=!0,Li=!0;function Et(t,e,r){let n=t.match(e);return n&&n.length>=r&&parseInt(n[r],10)}s(Et,"extractVersion");function de(t,e,r){if(!t.RTCPeerConnection)return;let n=t.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(o,c){if(o!==e)return i.apply(this,arguments);let u=s(d=>{let p=r(d);p&&(c.handleEvent?c.handleEvent(p):c(p))},"wrappedCallback");return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(c,u),i.apply(this,[o,u])};let a=n.removeEventListener;n.removeEventListener=function(o,c){if(o!==e||!this._eventMap||!this._eventMap[e])return a.apply(this,arguments);if(!this._eventMap[e].has(c))return a.apply(this,arguments);let u=this._eventMap[e].get(c);return this._eventMap[e].delete(c),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[o,u])},Object.defineProperty(n,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}s(de,"wrapPeerConnectionEvent");function Ai(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Ni=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}s(Ai,"disableLog");function Ui(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Li=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}s(Ui,"disableWarnings");function ar(){if(typeof window=="object"){if(Ni)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}s(ar,"log");function Qe(t,e){!Li||console.warn(t+" is deprecated, please use "+e+" instead.")}s(Qe,"deprecated");function Gi(t){let e={browser:null,version:null};if(typeof t=="undefined"||!t.navigator)return e.browser="Not a browser.",e;let{navigator:r}=t;if(r.mozGetUserMedia)e.browser="firefox",e.version=Et(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection&&!t.RTCIceGatherer)e.browser="chrome",e.version=Et(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=Et(r.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}s(Gi,"detectBrowser");function Mi(t){return Object.prototype.toString.call(t)==="[object Object]"}s(Mi,"isObject");function en(t){return Mi(t)?Object.keys(t).reduce(function(e,r){let n=Mi(t[r]),i=n?en(t[r]):t[r],a=n&&!Object.keys(i).length;return i===void 0||a?e:Object.assign(e,{[r]:i})},{}):t}s(en,"compactObject");function Zr(t,e,r){!e||r.has(e.id)||(r.set(e.id,e),Object.keys(e).forEach(n=>{n.endsWith("Id")?Zr(t,t.get(e[n]),r):n.endsWith("Ids")&&e[n].forEach(i=>{Zr(t,t.get(i),r)})}))}s(Zr,"walkStats");function tn(t,e,r){let n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;let a=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&a.push(o)}),a.forEach(o=>{t.forEach(c=>{c.type===n&&c.trackId===o.id&&Zr(t,c,i)})}),i}s(tn,"filterStats");var cr={};Xe(cr,{fixNegotiationNeeded:()=>un,shimAddTrackRemoveTrack:()=>cn,shimAddTrackRemoveTrackWithNative:()=>Fi,shimGetDisplayMedia:()=>ji,shimGetSendersWithDtmf:()=>an,shimGetStats:()=>sn,shimGetUserMedia:()=>sr,shimMediaStream:()=>rn,shimOnTrack:()=>nn,shimPeerConnection:()=>or,shimSenderReceiverGetStats:()=>on});var Bi=ar;function sr(t,e){let r=t&&t.navigator;if(!r.mediaDevices)return;let n=s(function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;let u={};return Object.keys(c).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;let p=typeof c[d]=="object"?c[d]:{ideal:c[d]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);let f=s(function(h,v){return h?h+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v},"oldname_");if(p.ideal!==void 0){u.optional=u.optional||[];let h={};typeof p.ideal=="number"?(h[f("min",d)]=p.ideal,u.optional.push(h),h={},h[f("max",d)]=p.ideal,u.optional.push(h)):(h[f("",d)]=p.ideal,u.optional.push(h))}p.exact!==void 0&&typeof p.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[f("",d)]=p.exact):["min","max"].forEach(h=>{p[h]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[f(h,d)]=p[h])})}),c.advanced&&(u.optional=(u.optional||[]).concat(c.advanced)),u},"constraintsToChrome_"),i=s(function(c,u){if(e.version>=61)return u(c);if(c=JSON.parse(JSON.stringify(c)),c&&typeof c.audio=="object"){let d=s(function(p,f,h){f in p&&!(h in p)&&(p[h]=p[f],delete p[f])},"remap");c=JSON.parse(JSON.stringify(c)),d(c.audio,"autoGainControl","googAutoGainControl"),d(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=n(c.audio)}if(c&&typeof c.video=="object"){let d=c.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});let p=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!p)){delete c.video.facingMode;let f;if(d.exact==="environment"||d.ideal==="environment"?f=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(f=["front"]),f)return r.mediaDevices.enumerateDevices().then(h=>{h=h.filter(C=>C.kind==="videoinput");let v=h.find(C=>f.some(O=>C.label.toLowerCase().includes(O)));return!v&&h.length&&f.includes("back")&&(v=h[h.length-1]),v&&(c.video.deviceId=d.exact?{exact:v.deviceId}:{ideal:v.deviceId}),c.video=n(c.video),Bi("chrome: "+JSON.stringify(c)),u(c)})}c.video=n(c.video)}return Bi("chrome: "+JSON.stringify(c)),u(c)},"shimConstraints_"),a=s(function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},"shimError_"),o=s(function(c,u,d){i(c,p=>{r.webkitGetUserMedia(p,u,f=>{d&&d(a(f))})})},"getUserMedia_");if(r.getUserMedia=o.bind(r),r.mediaDevices.getUserMedia){let c=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(u){return i(u,d=>c(d).then(p=>{if(d.audio&&!p.getAudioTracks().length||d.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(a(p))))}}}s(sr,"shimGetUserMedia");function ji(t,e){if(!(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices)&&!!t.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}t.navigator.mediaDevices.getDisplayMedia=s(function(n){return e(n).then(i=>{let a=n.video&&n.video.width,o=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},a&&(n.video.mandatory.maxWidth=a),o&&(n.video.mandatory.maxHeight=o),t.navigator.mediaDevices.getUserMedia(n)})},"getDisplayMedia")}}s(ji,"shimGetDisplayMedia");function rn(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}s(rn,"shimMediaStream");function nn(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});let e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=s(function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let a;t.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):a={track:i.track};let o=new Event("track");o.track=i.track,o.receiver=a,o.transceiver={receiver:a},o.streams=[n.stream],this.dispatchEvent(o)}),n.stream.getTracks().forEach(i=>{let a;t.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(c=>c.track&&c.track.id===i.id):a={track:i};let o=new Event("track");o.track=i,o.receiver=a,o.transceiver={receiver:a},o.streams=[n.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)},"setRemoteDescription")}else de(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}s(nn,"shimOnTrack");function an(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){let e=s(function(i,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=i.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:i}},"shimSenderWithDtmf");if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=s(function(){return this._senders=this._senders||[],this._senders.slice()},"getSenders");let i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=s(function(c,u){let d=i.apply(this,arguments);return d||(d=e(this,c),this._senders.push(d)),d},"addTrack");let a=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=s(function(c){a.apply(this,arguments);let u=this._senders.indexOf(c);u!==-1&&this._senders.splice(u,1)},"removeTrack")}let r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=s(function(a){this._senders=this._senders||[],r.apply(this,[a]),a.getTracks().forEach(o=>{this._senders.push(e(this,o))})},"addStream");let n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=s(function(a){this._senders=this._senders||[],n.apply(this,[a]),a.getTracks().forEach(o=>{let c=this._senders.find(u=>u.track===o);c&&this._senders.splice(this._senders.indexOf(c),1)})},"removeStream")}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){let e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=s(function(){let n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n},"getSenders"),Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}s(an,"shimGetSendersWithDtmf");function sn(t){if(!t.RTCPeerConnection)return;let e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=s(function(){let[n,i,a]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);let o=s(function(u){let d={};return u.result().forEach(f=>{let h={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(v=>{h[v]=f.stat(v)}),d[h.id]=h}),d},"fixChromeStats_"),c=s(function(u){return new Map(Object.keys(u).map(d=>[d,u[d]]))},"makeMapStats");if(arguments.length>=2){let u=s(function(d){i(c(o(d)))},"successCallbackWrapper_");return e.apply(this,[u,n])}return new Promise((u,d)=>{e.apply(this,[function(p){u(c(o(p)))},d])}).then(i,a)},"getStats")}s(sn,"shimGetStats");function on(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){let r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=s(function(){let a=r.apply(this,[]);return a.forEach(o=>o._pc=this),a},"getSenders"));let n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=s(function(){let a=n.apply(this,arguments);return a._pc=this,a},"addTrack")),t.RTCRtpSender.prototype.getStats=s(function(){let a=this;return this._pc.getStats().then(o=>tn(o,a.track,!0))},"getStats")}if(!("getStats"in t.RTCRtpReceiver.prototype)){let r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=s(function(){let i=r.apply(this,[]);return i.forEach(a=>a._pc=this),i},"getReceivers")),de(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=s(function(){let i=this;return this._pc.getStats().then(a=>tn(a,i.track,!1))},"getStats")}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;let e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=s(function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){let n=arguments[0],i,a,o;return this.getSenders().forEach(c=>{c.track===n&&(i?o=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(a?o=!0:a=c),c.track===n)),o||i&&a?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():a?a.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)},"getStats")}s(on,"shimSenderReceiverGetStats");function Fi(t){t.RTCPeerConnection.prototype.getLocalStreams=s(function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])},"getLocalStreams");let e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=s(function(o,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let u=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(u)===-1&&this._shimmedLocalStreams[c.id].push(u):this._shimmedLocalStreams[c.id]=[c,u],u},"addTrack");let r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=s(function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(d=>{if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});let c=this.getSenders();r.apply(this,arguments);let u=this.getSenders().filter(d=>c.indexOf(d)===-1);this._shimmedLocalStreams[o.id]=[o].concat(u)},"addStream");let n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=s(function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],n.apply(this,arguments)},"removeStream");let i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=s(function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(c=>{let u=this._shimmedLocalStreams[c].indexOf(o);u!==-1&&this._shimmedLocalStreams[c].splice(u,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),i.apply(this,arguments)},"removeTrack")}s(Fi,"shimAddTrackRemoveTrackWithNative");function cn(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Fi(t);let r=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=s(function(){let p=r.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(f=>this._reverseStreams[f.id])},"getLocalStreams");let n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=s(function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(f=>{if(this.getSenders().find(v=>v.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){let f=new t.MediaStream(p.getTracks());this._streams[p.id]=f,this._reverseStreams[f.id]=p,p=f}n.apply(this,[p])},"addStream");let i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=s(function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},"removeStream"),t.RTCPeerConnection.prototype.addTrack=s(function(p,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(O=>O===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(O=>O.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let C=this._streams[f.id];if(C)C.addTrack(p),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let O=new t.MediaStream([p]);this._streams[f.id]=O,this._reverseStreams[O.id]=f,this.addStream(O)}return this.getSenders().find(O=>O.track===p)},"addTrack");function a(d,p){let f=p.sdp;return Object.keys(d._reverseStreams||[]).forEach(h=>{let v=d._reverseStreams[h],C=d._streams[v.id];f=f.replace(new RegExp(C.id,"g"),v.id)}),new RTCSessionDescription({type:p.type,sdp:f})}s(a,"replaceInternalStreamId");function o(d,p){let f=p.sdp;return Object.keys(d._reverseStreams||[]).forEach(h=>{let v=d._reverseStreams[h],C=d._streams[v.id];f=f.replace(new RegExp(v.id,"g"),C.id)}),new RTCSessionDescription({type:p.type,sdp:f})}s(o,"replaceExternalStreamId"),["createOffer","createAnswer"].forEach(function(d){let p=t.RTCPeerConnection.prototype[d],f={[d](){let h=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[C=>{let O=a(this,C);h[0].apply(null,[O])},C=>{h[1]&&h[1].apply(null,C)},arguments[2]]):p.apply(this,arguments).then(C=>a(this,C))}};t.RTCPeerConnection.prototype[d]=f[d]});let c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=s(function(){return!arguments.length||!arguments[0].type?c.apply(this,arguments):(arguments[0]=o(this,arguments[0]),c.apply(this,arguments))},"setLocalDescription");let u=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){let d=u.get.apply(this);return d.type===""?d:a(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=s(function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(p._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(O=>p.track===O)&&(h=this._streams[v])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))},"removeTrack")}s(cn,"shimAddTrackRemoveTrack");function or(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),!!t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){let n=t.RTCPeerConnection.prototype[r],i={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=i[r]})}s(or,"shimPeerConnection");function un(t,e){de(t,"negotiationneeded",r=>{let n=r.target;if(!((e.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return r})}s(un,"fixNegotiationNeeded");var pr={};Xe(pr,{shimAddTransceiver:()=>hn,shimCreateAnswer:()=>vn,shimCreateOffer:()=>_n,shimGetDisplayMedia:()=>wi,shimGetParameters:()=>gn,shimGetUserMedia:()=>ur,shimOnTrack:()=>dn,shimPeerConnection:()=>dr,shimRTCDataChannel:()=>mn,shimReceiverGetStats:()=>fn,shimRemoveStream:()=>ln,shimSenderGetStats:()=>pn});function ur(t,e){let r=t&&t.navigator,n=t&&t.MediaStreamTrack;if(r.getUserMedia=function(i,a,o){Qe("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(i).then(a,o)},!(e.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){let i=s(function(o,c,u){c in o&&!(u in o)&&(o[u]=o[c],delete o[c])},"remap"),a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),a(o)},n&&n.prototype.getSettings){let o=n.prototype.getSettings;n.prototype.getSettings=function(){let c=o.apply(this,arguments);return i(c,"mozAutoGainControl","autoGainControl"),i(c,"mozNoiseSuppression","noiseSuppression"),c}}if(n&&n.prototype.applyConstraints){let o=n.prototype.applyConstraints;n.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c,"autoGainControl","mozAutoGainControl"),i(c,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[c])}}}}s(ur,"shimGetUserMedia");function wi(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||!t.navigator.mediaDevices||(t.navigator.mediaDevices.getDisplayMedia=s(function(n){if(!(n&&n.video)){let i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)},"getDisplayMedia"))}s(wi,"shimGetDisplayMedia");function dn(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}s(dn,"shimOnTrack");function dr(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let a=t.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=o[i]});let r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=s(function(){let[a,o,c]=arguments;return n.apply(this,[a||null]).then(u=>{if(e.version<53&&!o)try{u.forEach(d=>{d.type=r[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;u.forEach((p,f)=>{u.set(f,Object.assign({},p,{type:r[p.type]||p.type}))})}return u}).then(o,c)},"getStats")}s(dr,"shimPeerConnection");function pn(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;let e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=s(function(){let i=e.apply(this,[]);return i.forEach(a=>a._pc=this),i},"getSenders"));let r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=s(function(){let i=r.apply(this,arguments);return i._pc=this,i},"addTrack")),t.RTCRtpSender.prototype.getStats=s(function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)},"getStats")}s(pn,"shimSenderGetStats");function fn(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;let e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=s(function(){let n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n},"getReceivers")),de(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=s(function(){return this._pc.getStats(this.track)},"getStats")}s(fn,"shimReceiverGetStats");function ln(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=s(function(r){Qe("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&r.getTracks().includes(n.track)&&this.removeTrack(n)})},"removeStream"))}s(ln,"shimRemoveStream");function mn(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}s(mn,"shimRTCDataChannel");function hn(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;let e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=s(function(){this.setParametersPromises=[];let n=arguments[1],i=n&&"sendEncodings"in n;i&&n.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let a=e.apply(this,arguments);if(i){let{sender:o}=a,c=o.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n.sendEncodings,o.sendEncodings=n.sendEncodings,this.setParametersPromises.push(o.setParameters(c).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return a},"addTransceiver"))}s(hn,"shimAddTransceiver");function gn(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;let e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=s(function(){let n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n},"getParameters"))}s(gn,"shimGetParameters");function _n(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;let e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=s(function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)},"createOffer")}s(_n,"shimCreateOffer");function vn(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;let e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=s(function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)},"createAnswer")}s(vn,"shimCreateAnswer");var fr={};Xe(fr,{shimAudioContext:()=>Cn,shimCallbacksAPI:()=>yn,shimConstraints:()=>Yi,shimCreateOfferLegacy:()=>kn,shimGetUserMedia:()=>En,shimLocalStreamsAPI:()=>Sn,shimRTCIceServerUrls:()=>bn,shimRemoteStreamsAPI:()=>Tn,shimTrackEventTransceiver:()=>Rn});function Sn(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=s(function(){return this._localStreams||(this._localStreams=[]),this._localStreams},"getLocalStreams")),!("addStream"in t.RTCPeerConnection.prototype)){let e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=s(function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>e.call(this,i,n)),n.getVideoTracks().forEach(i=>e.call(this,i,n))},"addStream"),t.RTCPeerConnection.prototype.addTrack=s(function(n,...i){return i&&i.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)},"addTrack")}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=s(function(r){this._localStreams||(this._localStreams=[]);let n=this._localStreams.indexOf(r);if(n===-1)return;this._localStreams.splice(n,1);let i=r.getTracks();this.getSenders().forEach(a=>{i.includes(a.track)&&this.removeTrack(a)})},"removeStream"))}}s(Sn,"shimLocalStreamsAPI");function Tn(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=s(function(){return this._remoteStreams?this._remoteStreams:[]},"getRemoteStreams")),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);let a=new Event("addstream");a.stream=i,this.dispatchEvent(a)})})}});let e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=s(function(){let n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(a=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(a)>=0)return;n._remoteStreams.push(a);let o=new Event("addstream");o.stream=a,n.dispatchEvent(o)})}),e.apply(n,arguments)},"setRemoteDescription")}}s(Tn,"shimRemoteStreamsAPI");function yn(t){if(typeof t!="object"||!t.RTCPeerConnection)return;let e=t.RTCPeerConnection.prototype,r=e.createOffer,n=e.createAnswer,i=e.setLocalDescription,a=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=s(function(d,p){let f=arguments.length>=2?arguments[2]:arguments[0],h=r.apply(this,[f]);return p?(h.then(d,p),Promise.resolve()):h},"createOffer"),e.createAnswer=s(function(d,p){let f=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[f]);return p?(h.then(d,p),Promise.resolve()):h},"createAnswer");let c=s(function(u,d,p){let f=i.apply(this,[u]);return p?(f.then(d,p),Promise.resolve()):f},"withCallback");e.setLocalDescription=c,c=s(function(u,d,p){let f=a.apply(this,[u]);return p?(f.then(d,p),Promise.resolve()):f},"withCallback"),e.setRemoteDescription=c,c=s(function(u,d,p){let f=o.apply(this,[u]);return p?(f.then(d,p),Promise.resolve()):f},"withCallback"),e.addIceCandidate=c}s(yn,"shimCallbacksAPI");function En(t){let e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){let r=e.mediaDevices,n=r.getUserMedia.bind(r);e.mediaDevices.getUserMedia=i=>n(Yi(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=s(function(n,i,a){e.mediaDevices.getUserMedia(n).then(i,a)},"getUserMedia").bind(e))}s(En,"shimGetUserMedia");function Yi(t){return t&&t.video!==void 0?Object.assign({},t,{video:en(t.video)}):t}s(Yi,"shimConstraints");function bn(t){if(!t.RTCPeerConnection)return;let e=t.RTCPeerConnection;t.RTCPeerConnection=s(function(n,i){if(n&&n.iceServers){let a=[];for(let o=0;o<n.iceServers.length;o++){let c=n.iceServers[o];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(Qe("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,a.push(c)):a.push(n.iceServers[o])}n.iceServers=a}return new e(n,i)},"RTCPeerConnection"),t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}s(bn,"shimRTCIceServerUrls");function Rn(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}s(Rn,"shimTrackEventTransceiver");function kn(t){let e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=s(function(n){if(n){typeof n.offerToReceiveAudio!="undefined"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);let i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof n.offerToReceiveVideo!="undefined"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);let a=this.getTransceivers().find(o=>o.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):n.offerToReceiveVideo===!0&&!a&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)},"createOffer")}s(kn,"shimCreateOfferLegacy");function Cn(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}s(Cn,"shimAudioContext");var In={};Xe(In,{removeExtmapAllowMixed:()=>mr,shimAddIceCandidateNullOrEmpty:()=>xt,shimConnectionState:()=>lr,shimMaxMessageSize:()=>kt,shimParameterlessSetLocalDescription:()=>Pt,shimRTCIceCandidate:()=>Rt,shimSendThrowTypeError:()=>Ct});var bt=ue(Pn());function Rt(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;let e=t.RTCIceCandidate;t.RTCIceCandidate=s(function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){let i=new e(n),a=bt.default.parseCandidate(n.candidate),o=Object.assign(i,a);return o.toJSON=s(function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},"toJSON"),o}return new e(n)},"RTCIceCandidate"),t.RTCIceCandidate.prototype=e.prototype,de(t,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new t.RTCIceCandidate(r.candidate),writable:"false"}),r))}s(Rt,"shimRTCIceCandidate");function kt(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp=="undefined"?null:this._sctp}});let r=s(function(c){if(!c||!c.sdp)return!1;let u=bt.default.splitSections(c.sdp);return u.shift(),u.some(d=>{let p=bt.default.parseMLine(d);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},"sctpInDescription"),n=s(function(c){let u=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;let d=parseInt(u[1],10);return d!==d?-1:d},"getRemoteFirefoxVersion"),i=s(function(c){let u=65536;return e.browser==="firefox"&&(e.version<57?c===-1?u=16384:u=2147483637:e.version<60?u=e.version===57?65535:65536:u=2147483637),u},"getCanSendMaxMessageSize"),a=s(function(c,u){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);let p=bt.default.matchPrefix(c.sdp,"a=max-message-size:");return p.length>0?d=parseInt(p[0].substr(19),10):e.browser==="firefox"&&u!==-1&&(d=2147483637),d},"getMaxMessageSize"),o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=s(function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){let{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp=="undefined"?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){let u=n(arguments[0]),d=i(u),p=a(arguments[0],u),f;d===0&&p===0?f=Number.POSITIVE_INFINITY:d===0||p===0?f=Math.max(d,p):f=Math.min(d,p);let h={};Object.defineProperty(h,"maxMessageSize",{get(){return f}}),this._sctp=h}return o.apply(this,arguments)},"setRemoteDescription")}s(kt,"shimMaxMessageSize");function Ct(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(n,i){let a=n.send;n.send=s(function(){let c=arguments[0],u=c.length||c.size||c.byteLength;if(n.readyState==="open"&&i.sctp&&u>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return a.apply(n,arguments)},"send")}s(e,"wrapDcSend");let r=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=s(function(){let i=r.apply(this,arguments);return e(i,this),i},"createDataChannel"),de(t,"datachannel",n=>(e(n.channel,n.target),n))}s(Ct,"shimSendThrowTypeError");function lr(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;let e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{let n=e[r];e[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{let a=i.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;let o=new Event("connectionstatechange",i);a.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}s(lr,"shimConnectionState");function mr(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;let r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=s(function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let a=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:a}):i.sdp=a}return r.apply(this,arguments)},"setRemoteDescription")}s(mr,"removeExtmapAllowMixed");function xt(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;let r=t.RTCPeerConnection.prototype.addIceCandidate;!r||r.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=s(function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())},"addIceCandidate"))}s(xt,"shimAddIceCandidateNullOrEmpty");function Pt(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;let r=t.RTCPeerConnection.prototype.setLocalDescription;!r||r.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=s(function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return r.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?r.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>r.apply(this,[o]))},"setLocalDescription"))}s(Pt,"shimParameterlessSetLocalDescription");var eo=ue(Pn());function $i({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let r=ar,n=Gi(t),i={browserDetails:n,commonShim:In,extractVersion:Et,disableLog:Ai,disableWarnings:Ui,sdp:eo};switch(n.browser){case"chrome":if(!cr||!or||!e.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(n.version===null)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=cr,xt(t,n),Pt(t,n),sr(t,n),rn(t,n),or(t,n),nn(t,n),cn(t,n),an(t,n),sn(t,n),on(t,n),un(t,n),Rt(t,n),lr(t,n),kt(t,n),Ct(t,n),mr(t,n);break;case"firefox":if(!pr||!dr||!e.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=pr,xt(t,n),Pt(t,n),ur(t,n),dr(t,n),dn(t,n),ln(t,n),pn(t,n),fn(t,n),mn(t,n),hn(t,n),gn(t,n),_n(t,n),vn(t,n),Rt(t,n),lr(t,n),kt(t,n),Ct(t,n);break;case"safari":if(!fr||!e.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=fr,xt(t,n),Pt(t,n),bn(t,n),kn(t,n),yn(t,n),Sn(t,n),Tn(t,n),Rn(t,n),En(t,n),Cn(t,n),Rt(t,n),kt(t,n),Ct(t,n),mr(t,n);break;default:r("Unsupported browser!");break}return i}s($i,"adapterFactory");var Fu=$i({window:typeof window=="undefined"?void 0:window});var Vs=ue(Ee());var _r=(u=>(u.TrackMuted="TrackMuted",u.TrackUnmuted="TrackUnmuted",u.TrackPublished="TrackPublished",u.TrackUnpublished="TrackUnpublished",u.TrackSubscribed="TrackSubscribed",u.TrackUnsubscribed="TrackUnsubscribed",u.StartedSpeaking="StartedSpeaking",u.StoppedSpeaking="StoppedSpeaking",u))(_r||{});var ea=ue(Ee());var It=(n=>(n[n.Unknown=0]="Unknown",n[n.Publisher=1]="Publisher",n[n.Subscriber=2]="Subscriber",n))(It||{});var Le=class extends ea.EventEmitter{constructor(r,n,i){super();this.metadata={};this.audioTracks=new Map;this.videoTracks=new Map;switch(this.connectionId=r,this.id=i||r,n){case 1:this.role=1;break;case 2:this.role=2;break;default:this.role=0}}getVideoTracks(){return Array.from(this.videoTracks.values())}getAudioTracks(){return Array.from(this.audioTracks.values())}};s(Le,"RemoteParticipant");var ta=ue(Ee());var et=(n=>(n[n.Unknown=0]="Unknown",n[n.Audio=1]="Audio",n[n.Video=2]="Video",n))(et||{}),Dt=(a=>(a.Unknown="unknown",a.Camera="camera",a.Microphone="microphone",a.Screenshare="screenshare",a.ScreenshareAudio="screenshareaudio",a))(Dt||{});var be=class extends ta.EventEmitter{constructor(r,n){super();this.source="unknown";this.attachedElements=[];switch(r.source){case"microphone":this.source="microphone";break;case"camera":this.source="camera";break;case"screenshare":this.source="screenshare";break;case"screenshareaudio":this.source="screenshareaudio";break}this.tid=r.tid,this.metadata=r.metadata,this.kind=r.type,this.name=r.name,this.muted=r.muted,this.height=r.height,this.width=r.width,this.track=n}isMuted(){return this.muted}getSource(){return this.source}getKind(){return this.kind}attach(r){if(!this.track)return;let n,i;r?i=r:i=new HTMLMediaElement,i.srcObject instanceof MediaStream?n=i.srcObject:(n=new MediaStream,i.srcObject=n);let a;return this.kind===1?a=n.getAudioTracks():a=n.getVideoTracks(),a.forEach(o=>{n.removeTrack(o)}),this.attachedElements.push(i),n.addTrack(this.track),i}detach(r){let n=[];if(!r)this.attachedElements.forEach(i=>{n.push(this.detachFromElement(i))}),this.attachedElements=[];else{n.push(this.detachFromElement(r));let i=this.attachedElements.filter(a=>a!==r);this.attachedElements=i}return n}detachFromElement(r){return r.srcObject instanceof MediaStream&&this.track&&r.srcObject.removeTrack(this.track),r}};s(be,"Track");var Ae=class extends be{constructor(r){super(r);this.subscribed=!1}subscribe(){this.subscribed=!0}unSubscribe(){this.subscribed=!1}isSubscribed(){return this.subscribed}};s(Ae,"RemoteTrack");var vr=(r=>(r.Muted="Muted",r.Unmuted="Unmuted",r))(vr||{});var tt=class extends be{constructor(r,n,i){super(r);this.track=n,this.deviceId=i}mute(){this.muted=!0,this.track.enabled=!1,this.emit("Muted",this)}unMute(){this.muted=!1,this.track.enabled=!0,this.emit("Unmuted",this)}};s(tt,"LocalTrack");var ca=ue(Ee());var Sr,oo=new Uint8Array(16);function On(){if(!Sr&&(Sr=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Sr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Sr(oo)}s(On,"rng");var ra=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function co(t){return typeof t=="string"&&ra.test(t)}s(co,"validate");var na=co;var D=[];for(Tr=0;Tr<256;++Tr)D.push((Tr+256).toString(16).substr(1));var Tr;function uo(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(D[t[e+0]]+D[t[e+1]]+D[t[e+2]]+D[t[e+3]]+"-"+D[t[e+4]]+D[t[e+5]]+"-"+D[t[e+6]]+D[t[e+7]]+"-"+D[t[e+8]]+D[t[e+9]]+"-"+D[t[e+10]]+D[t[e+11]]+D[t[e+12]]+D[t[e+13]]+D[t[e+14]]+D[t[e+15]]).toLowerCase();if(!na(r))throw TypeError("Stringified UUID is invalid");return r}s(uo,"stringify");var ia=uo;function po(t,e,r){t=t||{};var n=t.random||(t.rng||On)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(var i=0;i<16;++i)e[r+i]=n[i];return e}return ia(n)}s(po,"v4");var Mn=po;var yr=class{constructor(e){this.date=new Date;this.level=2;this.disabledScopes=e,typeof window!="undefined"&&window.VERBOSE_LOGGING&&(this.level=0)}debug(e,r,...n){this.level>0||this.disabledScopes.find(i=>i===e)||this.log(r,e,"DEBUG",...n)}info(e,r,...n){this.level>1||this.disabledScopes.find(i=>i===e)||this.log(r,e,"INFO",...n)}warn(e,r,...n){this.disabledScopes.find(i=>i===e)||this.log(r,e,"WARN",...n)}error(e,r,...n){this.disabledScopes.find(i=>i===e)||this.log(r,e,"ERROR",...n)}log(e,r,n,...i){this.date.setTime(Date.now());let a=`${this.date.getUTCFullYear()}-${this.date.getUTCMonth()}-${this.date.getUTCDate()}T${this.date.getUTCHours()}:${this.date.getUTCMinutes()}:${this.date.getUTCSeconds()}.${this.date.getUTCMilliseconds()}`,o=`${e}`;i.forEach(d=>{o=`${o} ${JSON.stringify(d)}`});let c={timestamp:a,level:n,scope:r,msg:o},u=console.log;switch(n){case"WARN":u=console.warn;break;case"ERROR":u=console.error;break}u(c)}};s(yr,"Logger");var g=new yr([]);function aa(t,e){let r=Object.setPrototypeOf;r?r(t,e):t.__proto__=e}s(aa,"fixProto");function sa(t,e=t.constructor){let r=Error.captureStackTrace;r&&r(t,e)}s(sa,"fixStack");var L=class extends Error{constructor(r,n){super(r);Object.defineProperty(this,"name",{value:new.target.name,enumerable:!1,configurable:!0}),aa(this,new.target.prototype),sa(this,n)}};s(L,"MuxError");var pe=class extends L{constructor(r){super(r.message);this.type=r.type,this.visibility=r.visibility}};s(pe,"InternalSignalingError");var rt=class extends L{constructor(e,r){super(e,r)}};s(rt,"JWTError");var nt=class extends L{constructor(e){super(e)}};s(nt,"InternalError");var it=class extends L{constructor(e,r){super(e,r)}};s(it,"ConnectionError");var Ot=class extends L{constructor(e){super(e)}};s(Ot,"WebsocketError");var Ue=class extends L{constructor(e){super(e)}};s(Ue,"PublishTrackError");var ne=class extends L{constructor(e){super(e)}};s(ne,"UnpublishTrackError");var Ge=class extends L{constructor(e){super(e)}};s(Ge,"UpdateTrackError");function oa(t){switch(t.type){case 6:case 3:return new rt(t.message,oa);case 7:return new it(t.message,oa);default:return new nt("unknown internal error")}}s(oa,"internalToExternalError");function kd(t){return new pe(t)}s(kd,"convertSignalingError");var fe="LocalParticipant",mo=720,ho=1280,go=1440,_o=2560,Re=class extends ca.EventEmitter{constructor(r,n,i,a){super();this.metadata={};this.audioTracks=new Map;this.videoTracks=new Map;this.connectionId=n,this.id=a||n,this.manager=r,this.role=i}async publishTracks(r){if(this.role===2)throw new Ue("Cannot publish tracks as a subscriber only participant");let n=[];if(r.forEach(i=>{this.hasLocalTrack(i)||this.addLocalTrack(i),n.push(i)}),await this.manager.publishTracks(n),n.length===0)throw new Error("no valid tracks found to publish");return n}updateTracks(r){if(this.role===2)throw new Ge("Updating tracks not allowed for subscriber only participants");let n=[],i=[];return r.forEach(a=>{let o;if(a.source==="camera")o=Array.from(this.videoTracks.values()).find(c=>c.source==="camera");else if(a.source==="microphone")o=Array.from(this.audioTracks.values()).find(c=>c.source==="microphone");else if(a.source==="screenshare")o=Array.from(this.videoTracks.values()).find(c=>c.source==="screenshare");else if(a.source==="screenshareaudio")o=Array.from(this.audioTracks.values()).find(c=>c.source==="screenshareaudio");else throw new Error("cannot update track unknown source");o?i.push({oldTrack:o,newTrack:a}):g.warn(fe,"tried updating track that didn't exist on local participant",a)}),i.forEach(a=>{try{let o=this.updateTrack(a.oldTrack,a.newTrack);o&&n.push(o)}catch(o){let c="error updating track",u="unknown update error";o instanceof Error&&(u=o.message),g.error(fe,`${c}: ${u}`)}}),n}async unpublishAllTracks(){if(this.role===2)throw new ne("Unpublishing not allowed for subscriber only participants");await this.manager.unpublishAllTracks()}unpublishTracks(r){if(this.role===2)throw new ne("Unpublishing not allowed for subscriber only participants");if(!r)return;let n=[];r.forEach(i=>{let a=this.hasLocalTrack(i);a?(n.push(a),this.removeLocalTrack(a.tid)):g.warn(fe,"tried unpublishing track that doesn't exist on local participant")}),this.manager.unpublishTracks(n)}getVideoTracks(){return Array.from(this.videoTracks.values())}getAudioTracks(){return Array.from(this.audioTracks.values())}async getUserMedia(r){var u,d;let n=(u=r==null?void 0:r.video)!=null&&u.constraints?r.video.constraints:{height:720,width:1280},i=(d=r==null?void 0:r.audio)!=null&&d.constraints?r.audio.constraints:{};return r&&r.video&&(n=this.validateVideoConstraints(n)),(await navigator.mediaDevices.getUserMedia({video:r&&r.video?n:!1,audio:r&&r.audio?i:!1})).getTracks().map(p=>{let f=this.localTrackFromMediaTrack(p,!1);return this.applyTrackOptions(f,r)})}async getDisplayMedia(r){var u;let n=(u=r==null?void 0:r.video)!=null&&u.constraints?r.video.constraints:{height:1440,width:2560};r&&r.video&&(n=this.validateVideoConstraints(n,!0));let i=15;return window.MUX_SPACES_GOOD_VIDEO&&(i=30),(await navigator.mediaDevices.getDisplayMedia({video:r&&r.video?{width:2560,height:1440,frameRate:i}:!1,audio:!!(r&&r.audio)})).getTracks().map(d=>{let p=this.localTrackFromMediaTrack(d,!0);return this.applyTrackOptions(p,r)})}hasLocalTrack(r){return this.getAudioTracks().concat(this.getVideoTracks()).find(n=>n.tid===r.tid)}addLocalTrack(r){switch(r.kind){case 1:this.audioTracks.set(r.tid,r);break;case 2:this.videoTracks.set(r.tid,r);break;default:throw g.error(fe,"unknown track kind passed to add track"),new Error("unknown track kind passed to add track")}r.on("Muted",n=>{this.onMute(n)}),r.on("Unmuted",n=>{this.onUnmute(n)}),this.emit("TrackPublished",r)}validateVideoConstraints(r,n=!1){let i=mo,a=ho;n&&(i=go,a=_o);let{height:o,width:c}=r;switch(typeof o){case"object":{if(!o)break;let{min:u,ideal:d,max:p}=o;if(u&&u>i||p&&p>i||d&&d>i)throw n?new Error("Invalid screenshare video height constraints. Screensharing in Mux Spaces is capped at 2560x1440."):new Error("Invalid camera video height constraints. Camera video in Mux Spaces is capped at 1280x720.");break}case"number":{o>i&&(n?g.warn(fe,"Screensharing in Mux Spaces is currently capped at 2560x1440, setting height to 1440."):g.warn(fe,"Camera video in Mux Spaces is currently capped at 1280x720, setting height to 720."),r.height=i);break}case"undefined":{r.height=i;break}default:throw new Error("Invalid video height contstraint. See https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia for valid constraints")}switch(typeof c){case"object":{if(!c)break;let{min:u,ideal:d,max:p}=c;if(u&&u>a||p&&p>a||d&&d>a)throw n?new Error("Invalid screenshare video width constraints. Screensharing in Mux Spaces is capped at 2560x1440."):new Error("Invalid camera video width constraints. Camera video in Mux Spaces is capped at 1280x720.");break}case"number":{c>a&&(n?g.warn(fe,"Screensharing in Mux Spaces is currently capped at 2560x1440, setting width to 2560."):g.warn(fe,"Camera video in Mux Spaces is currently capped at 1280x720, setting width to 1280."),r.width=a);break}case"undefined":{r.width=a;break}default:throw new Error("Invalid video width contstraint. See https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia for valid constraints")}return r}updateTrack(r,n){let i=r.track.id;return n.tid=r.tid,n.track.enabled=!r.muted,n.muted=r.muted,n.name=r.name,n.metadata=r.metadata,n.attachedElements=r.attachedElements,r.removeAllListeners(),r.track.stop(),this.manager.updateTrack(n,i),this.emit("TrackUnpublished",r),this.addLocalTrack(n),n}removeLocalTrack(r){let n=this.audioTracks.get(r);if(n)return n.removeAllListeners(),n.track&&n.detach(),this.audioTracks.delete(n.tid),this.emit("TrackUnpublished",n),n;if(n=this.videoTracks.get(r),n)return n.removeAllListeners(),n.track&&n.detach(),this.videoTracks.delete(n.tid),this.emit("TrackUnpublished",n),n;g.error(fe,"tried removing track that doesnt exist")}onMute(r){this.manager.client.sendMuteRequest(r.tid),this.emit("TrackMuted",r)}onUnmute(r){this.manager.client.sendUnmuteRequest(r.tid),this.emit("TrackUnmuted",r)}applyTrackOptions(r,n){var i,a,o,c;if(!n)return r;switch(r.kind){case 1:(i=n.audio)!=null&&i.name&&(r.name=n.audio.name),(a=n.audio)!=null&&a.metadata&&(r.metadata=n.audio.metadata);break;case 2:(o=n.video)!=null&&o.name&&(r.name=n.video.name),(c=n.video)!=null&&c.metadata&&(r.metadata=n.video.metadata);break}return r}localTrackFromMediaTrack(r,n){let i=r.kind==="audio"?1:2,a;switch(i){case 1:a=n?"screenshareaudio":"microphone";break;case 2:a=n?"screenshare":"camera"}return new tt({tid:Mn(),type:i,name:r.label,muted:r.muted,source:a,height:r.getSettings().height||0,width:r.getSettings().width||0,metadata:{}},r,r.getSettings().deviceId)}};s(Re,"LocalParticipant");var ua=(p=>(p.ParticipantJoined="ParticipantJoined",p.ParticipantLeft="ParticipantLeft",p.ParticipantTrackPublished="ParticipantTrackPublished",p.ParticipantTrackUnpublished="ParticipantTrackUnpublished",p.ParticipantTrackSubscribed="ParticipantTrackSubscribed",p.ParticipantTrackUnsubscribed="ParticipantTrackUnsubscribed",p.ParticipantTrackMuted="ParticipantTrackMuted",p.ParticipantTrackUnmuted="ParticipantTrackUnmuted",p.ActiveSpeakersChanged="ActiveSpeakersChanged",p.BroadcastStateChanged="BroadcastStateChanged",p))(ua||{});var ma=ue(Ee());function Er(t){switch(t.type){case 6:case 3:return new rt(t.message,Er);case 7:return new it(t.message,Er);default:return new nt("unknown internal error")}}s(Er,"internalToExternalError");function da(t){return new pe(t)}s(da,"convertSignalingError");var br="0.1.6";var Be="Signaling",Mt=class{constructor(){this.joined=!1}connect(e){let r="wss://spaces.mux.com/pluto";window.MUX_SPACES_BACKEND_URL&&(r=window.MUX_SPACES_BACKEND_URL);let n=`?token=${e}&sdk_version=web-${br}`;return new Promise((i,a)=>{g.info(Be,"connecting to",r+n),this.ws=void 0;let o=new WebSocket(r+n);o.onerror=async c=>{g.error(Be,"WS Error: ",c)},o.onopen=()=>{this.ws=o,this.joinResolver=i,this.joinRejector=a},o.onclose=c=>{this.onClose&&this.onClose(c.reason)},o.onmessage=c=>{let u=JSON.parse(c.data);if(!u){g.error(Be,"Message was empty");return}this.handleSignalMessage(u)}})}close(){var e;this.ws&&(this.ws.onclose=null),(e=this.ws)==null||e.close()}sendAnswer(e,r){this.sendRequest({sub_answer:{sfu_id:r,sdp:e}})}sendOffer(e){this.sendRequest({offer:e})}sendCandidate(e,r,n){this.sendRequest({candidate:{candidate:this.rtcCandidateToSigCandidate(e),type:r,sfu_id:n}})}sendPendingTrack(e,r){let n=e.kind.valueOf(),i={tid:e.tid,type:n,name:e.name,muted:e.muted,source:e.source,height:e.height,width:e.width,mid:r};this.sendRequest({pending_track:i})}sendMuteRequest(e){this.sendRequest({mute_track:e})}sendUnmuteRequest(e){this.sendRequest({unmute_track:e})}sendRequest(e){if(g.info(Be,"signalClient.sendRequest",e),!this.ws)throw new Error("cannot send signal request before connected");this.ws.send(JSON.stringify(e))}sigCandidateToRTCCandidate(e){let r={};return r.candidate=e.candidate,r.sdpMLineIndex=e.sdp_mline_index,r.sdpMid=e.sdp_mid,r.usernameFragment=e.username_fragment,r}rtcCandidateToSigCandidate(e){return{candidate:e.candidate,sdp_mline_index:e.sdpMLineIndex,sdp_mid:e.sdpMid,username_fragment:e.usernameFragment}}handleSignalMessage(e){var r,n;if(g.info(Be,"signalClient.handleSignalMessage",e),e.joined){let{joined:i}=e;this.joined=!0,this.joinResolver(i)}else if(e.participant_connected)this.onParticipantJoined&&this.onParticipantJoined(e.participant_connected);else if(e.participant_disconnected)this.onParticipantLeft&&this.onParticipantLeft(e.participant_disconnected);else if(e.add_track)this.onTrackAdded&&this.onTrackAdded(e.add_track);else if(e.remove_track)this.onTrackRemoved&&this.onTrackRemoved(e.remove_track);else if(e.sub_offer)this.onOffer&&this.onOffer(e.sub_offer);else if(e.candidate){if(this.onCandidate){let i=this.sigCandidateToRTCCandidate(e.candidate.candidate);this.onCandidate(i,e.candidate.type,e.candidate.sfu_id)}}else if(e.answer)this.onAnswer&&this.onAnswer(e.answer);else if(e.track_muted)this.onTrackMute&&this.onTrackMute(e.track_muted.connection_id,e.track_muted.track.tid);else if(e.track_unmuted)this.onTrackUnmute&&this.onTrackUnmute(e.track_unmuted.connection_id,e.track_unmuted.track.tid);else if(!e.pending_track_ack)if(e.active_speakers){let i=e.active_speakers.tracks.map(a=>({connectionId:a.connection_id,trackId:a.track_id}));(r=this.onActiveSpeakers)==null||r.call(this,i)}else if(e.broadcast_state_update)(n=this.onBroadcastStateUpdate)==null||n.call(this,e.broadcast_state_update);else if(e.error){if(!this.joined){this.joinRejector(da(e.error));return}g.error(Be,"error received from websocket",e.error)}else g.warn(Be,"unsupported message",e)}};s(Mt,"WSSignalClient");var fa=ue(Ee());var Rr="SubPc",Nt=class extends fa.EventEmitter{constructor(r,n){super();this.id=r,this.pc=new RTCPeerConnection({iceServers:n}),this.pc.onicecandidate=i=>{let{candidate:a}=i;a&&this.emit("IceCandidate",a.toJSON(),1,this.id)},this.pc.ontrack=i=>{this.emit("OnTrack",i,this)},this.pc.onconnectionstatechange=()=>{g.info(Rr,"connection state change: ",this.pc.connectionState)},this.pc.oniceconnectionstatechange=()=>{g.info(Rr,"ICE connection state change: ",this.pc.iceConnectionState)},this.pc.onsignalingstatechange=()=>{g.info(Rr,"signaling state change: ",this.pc.signalingState)}}async offerAnswer(r){await this.pc.setRemoteDescription({type:"offer",sdp:r});let n=await this.pc.createAnswer();return await this.pc.setLocalDescription(n),new Promise((i,a)=>{var o;i((o=this.pc.localDescription)==null?void 0:o.sdp)})}async addIceCandidate(r){if(this.pc.iceConnectionState!=="completed")try{await this.pc.addIceCandidate(r)}catch(n){g.error(Rr,"error adding ice candidate",r,n)}}close(){this.pc.close()}};s(Nt,"SubSFU");var la=ue(Ee());var q="PubPc";var st=class extends la.EventEmitter{constructor(r,n,i,a={}){var c,u,d;super();this.eventQueue=[];this.negotiating=!1;this.audioEncodings=[{maxBitrate:64e3}];this.cameraEncodings=[{maxBitrate:7e5}];this.screenshareEncodings=[{maxBitrate:2e6}];this.candidates=[];let o=(c=a.disableABRPublishing)!=null?c:!1;!o&&((u=n.camera_encodings)==null?void 0:u.length)>0&&(this.cameraEncodings=n.camera_encodings.map(this.toRTPEncodings)),!o&&((d=n.screenshare_encodings)==null?void 0:d.length)>0&&(this.screenshareEncodings=n.screenshare_encodings.map(this.toRTPEncodings)),window.MUX_SPACES_GOOD_VIDEO&&(this.screenshareEncodings=[{maxBitrate:5e6}]),this.id=r,this.pc=new RTCPeerConnection({iceServers:i}),this.pc.oniceconnectionstatechange=()=>{g.info(q,"ICE connection state change: ",this.pc.iceConnectionState),(this.pc.iceConnectionState==="disconnected"||this.pc.iceConnectionState==="failed")&&(g.warn(q,`iceConnectionState ${this.pc.iceConnectionState}, requesting ice restart`),this.eventQueue.push({track:void 0,event:"Restart"}),this.processQueue())},this.pc.onsignalingstatechange=()=>{this.pc.signalingState==="stable"&&this.negotiating&&(g.debug(q,"We are stable setting negotiating to false"),this.negotiating=!1,this.emit("NegotiationDone"))},this.pc.onicecandidate=p=>{let{candidate:f}=p;f&&this.emit("IceCandidate",f.toJSON(),2,this.id)}}publishTracks(r){let n=r.map(i=>({track:i,event:"Add"}));this.eventQueue=this.eventQueue.concat(n),this.processQueue()}async unpublishAllTracks(){g.info(q,"stopping publishing");let r=this.pc.getSenders();r&&r.forEach(n=>{var i;(i=this.pc)==null||i.removeTrack(n)}),await this.negotiate()}updateTrack(r,n){let i=this.pc.getSenders();if(!i)throw new Error("senders undefined for peer connection. Did you try to update before publishing?");let a=i.find(o=>o.track&&o.track.id===n);if(!a)throw new Error("no sender found for update track");a.replaceTrack(r.track),g.info(q,"track replaced")}unpublishTracks(r){let n=r.map(i=>({track:i,event:"Remove"}));this.eventQueue=this.eventQueue.concat(n),this.processQueue()}async processQueue(){if(this.eventQueue.length===0)return;let r=!1,n=this.eventQueue;this.eventQueue=[];let i=[];n.forEach(a=>{if(a.event==="Restart"){r=!0;return}if(!a.track||!a.track.track){g.error(q,"tried to process track with no media track");return}let o=a.track;if(a.event==="Add"){let c={direction:"sendonly"};switch(o.kind){case 2:o.source=="screenshare"?c.sendEncodings=this.screenshareEncodings:c.sendEncodings=this.cameraEncodings;break;case 1:c.sendEncodings=this.audioEncodings;break}let u=this.pc.addTransceiver(a.track.track,c);u&&i.push({track:a.track,transceiver:u})}else if(a.event==="Remove"){if(!a.track){g.error(q,"undefined local track for remove event");return}let u=this.pc.getSenders().find(d=>d.track&&a.track&&d.track.id===a.track.track.id);if(!u)return;this.pc.removeTrack(u)}}),await this.negotiate(r,i),this.eventQueue.length>0&&this.processQueue()}toRTPEncodings(r){let n={rid:r.rid};return r.max_bitrate>0&&(n.maxBitrate=r.max_bitrate),r.scale_resolution_down_by>0&&(n.scaleResolutionDownBy=r.scale_resolution_down_by),r.max_framerate>0&&(n.maxFramerate=r.max_framerate),n}async negotiate(r=!1,n=[]){var a;this.negotiating&&await this.waitForNegotiation(),this.negotiating=!0,this.pc.signalingState!=="stable"&&g.error(q,"negotiation called while not stable");let i=await this.pc.createOffer({iceRestart:r});await this.pc.setLocalDescription(i),n.forEach(o=>{o.transceiver.mid?this.emit("PendingTrack",o.track,o.transceiver.mid):g.error(q,"no MID for transceiver")}),this.emit("Offer",(a=this.pc.localDescription)==null?void 0:a.sdp)}waitForNegotiation(){return new Promise(r=>{this.on("NegotationDone",()=>{g.debug(q,"Negotiation Done"),r()})})}async addIceCandidate(r){if(this.pc.iceConnectionState!=="connected")try{await this.pc.addIceCandidate(r)}catch(n){n instanceof Error&&n.message.includes("remote description was null")?this.candidates.push(r):g.error(q,"error adding ice candidate",r,n)}}async answerOffer(r){await this.pc.setRemoteDescription({type:"answer",sdp:r}),this.candidates.forEach(async n=>{await this.addIceCandidate(n)}),this.candidates=[]}close(){this.pc.close()}};s(st,"PubSFU");var ot="RTCManager",Lt=class extends ma.EventEmitter{constructor(r,n,i={}){super();this.trackIdToConnId=new Map;this.subSfus=new Map,this.client=new Mt,this.candidates=[],this.spaceId=r,this.options=i,this.role=n,this.iceServers=[{urls:"stun:stun.l.google.com:19302"}]}async connect(r){let{session_id:n,connection_id:i,participant_id:a,sub_sfus:o,broadcasting:c,participants:u,simulcast:d,ice_servers:p}=await this.client.connect(r);try{this.iceServers=this.convertIceServers(p)}catch{}return this.client.onOffer=async f=>{this.offerOrCreateSub(f,this.iceServers)},this.client.onCandidate=(f,h,v)=>{let C;switch(h){case 1:C=this.subSfus.get(v),C?C.addIceCandidate(f):this.candidates.push({candidate:f,type:h,id:v});break;case 2:this.pub?this.pub.addIceCandidate(f):this.candidates.push({candidate:f,type:h,id:v});break;default:g.error(ot,"unknown candidate type:",h)}},this.client.onAnswer=async f=>{var h;this.role!==2&&((h=this.pub)==null||h.answerOffer(f))},this.sessionId=n,this.connectionId=i,this.participantId=a,g.info(ot,`Participant ID: ${this.participantId}`),g.info(ot,`Space ID: ${this.spaceId}`),o.forEach(f=>{this.offerOrCreateSub(f,this.iceServers)}),this.client.onParticipantJoined&&u.forEach(this.client.onParticipantJoined),this.role!==2&&(this.pub=new st(o[0].sfu_id,d,this.iceServers,this.options),this.pub.on("Offer",f=>{this.client.sendOffer(f)}),this.pub.on("PendingTrack",(f,h)=>{this.client.sendPendingTrack(f,h)}),this.pub.on("IceCandidate",(f,h,v)=>{this.client.sendCandidate(f,h,v)})),{sessionId:n,connectionId:i,participantId:a,broadcasting:c}}convertIceServers(r){if(!r)throw new Error("ice servers undefined");return r.map(n=>({urls:n.urls,credential:n.credential,username:n.username}))}async offerOrCreateSub(r,n){g.info(ot,"client.onOffer");let i,a=this.subSfus.get(r.sfu_id);if(a){i=await a.offerAnswer(r.sdp),this.client.sendAnswer(i,a.id);return}let o=new Nt(r.sfu_id,n);o.on("IceCandidate",(c,u,d)=>{this.client.sendCandidate(c,u,d)}),o.on("OnTrack",(c,u)=>{this.onMediaTrackAdded(c,u)}),i=await o.offerAnswer(r.sdp),this.subSfus.set(o.id,o),this.candidates.filter(c=>c.id===o.id&&c.type===1).forEach(c=>{o.addIceCandidate(c.candidate)}),this.candidates=this.candidates.filter(c=>{c.id,o.id}),this.client.sendAnswer(i,o.id)}onMediaTrackAdded(r,n){g.info(ot,"manager.onmediatrackadded",r);let i=r.streams[0].id,a=this.trackIdToConnId.get(i);if(!a){g.error(ot,"no participant found for track id:",i);return}this.emit("MediaTrackAdded",a,i,r.track)}publishTracks(r){var n;if(this.role===2)throw new Ue("Publishing not allowed for subscriber only participants");(n=this.pub)==null||n.publishTracks(r)}async unpublishAllTracks(){if(this.role===2)throw new ne("Unpublishing not allowed for subscriber only participants");if(!!this.pub)return this.pub.unpublishAllTracks()}updateTrack(r,n){if(this.role===2)throw new Ge("Updating tracks not allowed for subscriber only participants");if(!this.pub)throw new Error("tried to update track with no pub pc");this.pub.updateTrack(r,n)}unpublishTracks(r){var n;if(this.role===2)throw new ne("Unpublishing not allowed for subscriber only participants");(n=this.pub)==null||n.unpublishTracks(r)}unpublishTrack(r){var n;if(this.role===2)throw new ne("Unpublishing not allowed for subscriber only participants");(n=this.pub)==null||n.unpublishTracks([r])}close(){var r;Array.from(this.subSfus.values()).forEach(n=>{n.close()}),(r=this.pub)==null||r.close(),this.client.close()}debug(){var r,n;return{connectionId:(r=this.connectionId)!=null?r:"unknown connection id",spaceId:(n=this.spaceId)!=null?n:"unknown space id"}}};s(Lt,"RTCManager");function Nn(t,e){switch(e.kind){case 1:t.audioTracks.set(e.tid,e);break;case 2:t.videoTracks.set(e.tid,e);break;default:g.error("RemoteParticipant","unknown track kind passed to addRemoteTrack");break}}s(Nn,"addRemoteTrack");function ha(t,e){let r=t.audioTracks.get(e);if(r)return r.removeAllListeners(),r.track&&r.detach(),t.emit("TrackUnsubscribed",r),t.audioTracks.delete(r.tid),r;if(r=t.videoTracks.get(e),r)return r.removeAllListeners(),r.track&&r.detach(),t.emit("TrackUnsubscribed",r),t.videoTracks.delete(r.tid),r;g.error("RemoteParticipant","tried removing track that doesnt exist")}s(ha,"removeRemoteTrack");function At(t,e){return t.getAudioTracks().concat(t.getVideoTracks()).find(r=>r.tid===e)}s(At,"hasRemoteTrackId");function ga(t,e,r){let n=t.audioTracks.get(e);return n?(n.track=r,t.emit("TrackSubscribed",n),n):(n=t.videoTracks.get(e),n?(n.track=r,t.emit("TrackSubscribed",n),n):null)}s(ga,"setRemoteMediaTrack");function _a(t,e){return t.getAudioTracks().concat(t.getVideoTracks()).find(r=>r.tid===e)}s(_a,"hasLocalTrackId");var Ut=class{constructor(e){this.logs=[];this.space=e}debug(){return this.space.debug()}};s(Ut,"Debugger");function va(){return typeof __SENTRY_BROWSER_BUNDLE__!="undefined"&&!!__SENTRY_BROWSER_BUNDLE__}s(va,"isBrowserBundle");function le(){return!va()&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]"}s(le,"isNodeEnv");function z(t,e){return t.require(e)}s(z,"dynamicRequire");function Ln(t){let e;try{e=z(module,t)}catch{}try{let{cwd:r}=z(module,"process");e=z(module,`${r()}/node_modules/${t}`)}catch{}return e}s(Ln,"loadModule");var So={};function _(){return le()?global:typeof window!="undefined"?window:typeof self!="undefined"?self:So}s(_,"getGlobalObject");function je(t,e,r){var n=r||_(),i=n.__SENTRY__=n.__SENTRY__||{},a=i[t]||(i[t]=e());return a}s(je,"getGlobalSingleton");var Sa=Object.prototype.toString;function Gt(t){switch(Sa.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return M(t,Error)}}s(Gt,"isError");function ct(t,e){return Sa.call(t)===`[object ${e}]`}s(ct,"isBuiltin");function Bt(t){return ct(t,"ErrorEvent")}s(Bt,"isErrorEvent");function kr(t){return ct(t,"DOMError")}s(kr,"isDOMError");function An(t){return ct(t,"DOMException")}s(An,"isDOMException");function V(t){return ct(t,"String")}s(V,"isString");function ut(t){return t===null||typeof t!="object"&&typeof t!="function"}s(ut,"isPrimitive");function W(t){return ct(t,"Object")}s(W,"isPlainObject");function dt(t){return typeof Event!="undefined"&&M(t,Event)}s(dt,"isEvent");function Un(t){return typeof Element!="undefined"&&M(t,Element)}s(Un,"isElement");function Gn(t){return ct(t,"RegExp")}s(Gn,"isRegExp");function Fe(t){return Boolean(t&&t.then&&typeof t.then=="function")}s(Fe,"isThenable");function Bn(t){return W(t)&&"nativeEvent"in t&&"preventDefault"in t&&"stopPropagation"in t}s(Bn,"isSyntheticEvent");function jt(t){return typeof t=="number"&&t!==t}s(jt,"isNaN");function M(t,e){try{return t instanceof e}catch{return!1}}s(M,"isInstanceOf");function me(t,e){try{let c=t;var r=5,n=80,i=[];let u=0,d=0;var a=" > ",o=a.length;let p;for(;c&&u++<r&&(p=To(c,e),!(p==="html"||u>1&&d+i.length*o+p.length>=n));)i.push(p),d+=p.length,c=c.parentNode;return i.reverse().join(a)}catch{return"<unknown>"}}s(me,"htmlTreeAsString");function To(t,e){var r=t,n=[];let i,a,o,c,u;if(!r||!r.tagName)return"";n.push(r.tagName.toLowerCase());var d=e&&e.length?e.filter(f=>r.getAttribute(f)).map(f=>[f,r.getAttribute(f)]):null;if(d&&d.length)d.forEach(f=>{n.push(`[${f[0]}="${f[1]}"]`)});else if(r.id&&n.push(`#${r.id}`),i=r.className,i&&V(i))for(a=i.split(/\s+/),u=0;u<a.length;u++)n.push(`.${a[u]}`);var p=["type","name","title","alt"];for(u=0;u<p.length;u++)o=p[u],c=r.getAttribute(o),c&&n.push(`[${o}="${c}"]`);return n.join("")}s(To,"_htmlElementAsString");function jn(){var t=_();try{return t.document.location.href}catch{return""}}s(jn,"getLocationHref");var b=class extends Error{constructor(e){super(e),this.message=e,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}};s(b,"SentryError");var yo=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+))?@)([\w.-]+)(?::(\d+))?\/(.+)/;function Eo(t){return t==="http"||t==="https"}s(Eo,"isValidProtocol");function we(t,e=!1){let{host:r,path:n,pass:i,port:a,projectId:o,protocol:c,publicKey:u}=t;return`${c}://${u}${e&&i?`:${i}`:""}@${r}${a?`:${a}`:""}/${n&&`${n}/`}${o}`}s(we,"dsnToString");function bo(t){var e=yo.exec(t);if(!e)throw new b(`Invalid Sentry Dsn: ${t}`);let[r,n,i="",a,o="",c]=e.slice(1),u="",d=c;var p=d.split("/");if(p.length>1&&(u=p.slice(0,-1).join("/"),d=p.pop()),d){var f=d.match(/^\d+/);f&&(d=f[0])}return Ta({host:a,pass:i,path:u,projectId:d,port:o,protocol:r,publicKey:n})}s(bo,"dsnFromString");function Ta(t){return{protocol:t.protocol,publicKey:t.publicKey||"",pass:t.pass||"",host:t.host,port:t.port||"",path:t.path||"",projectId:t.projectId}}s(Ta,"dsnFromComponents");function Ro(t){if(!(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__))return;let{port:e,projectId:r,protocol:n}=t;var i=["protocol","publicKey","host","projectId"];if(i.forEach(a=>{if(!t[a])throw new b(`Invalid Sentry Dsn: ${a} missing`)}),!r.match(/^\d+$/))throw new b(`Invalid Sentry Dsn: Invalid projectId ${r}`);if(!Eo(n))throw new b(`Invalid Sentry Dsn: Invalid protocol ${n}`);if(e&&isNaN(parseInt(e,10)))throw new b(`Invalid Sentry Dsn: Invalid port ${e}`);return!0}s(Ro,"validateDsn");function Cr(t){var e=typeof t=="string"?bo(t):Ta(t);return Ro(e),e}s(Cr,"makeDsn");var ko=_(),Co="Sentry Logger ",pt=["debug","info","warn","error","log","assert","trace"];function xr(t){var e=_();if(!("console"in e))return t();var r=e.console,n={};pt.forEach(i=>{var a=r[i]&&r[i].__sentry_original__;i in e.console&&a&&(n[i]=r[i],r[i]=a)});try{return t()}finally{Object.keys(n).forEach(i=>{r[i]=n[i]})}}s(xr,"consoleSandbox");function ya(){let t=!1;var e={enable:()=>{t=!0},disable:()=>{t=!1}};return typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__?pt.forEach(r=>{e[r]=(...n)=>{t&&xr(()=>{ko.console[r](`${Co}[${r}]:`,...n)})}}):pt.forEach(r=>{e[r]=()=>{}}),e}s(ya,"makeLogger");var l;typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__?l=je("logger",ya):l=ya();function ke(t,e=0){return typeof t!="string"||e===0||t.length<=e?t:`${t.substr(0,e)}...`}s(ke,"truncate");function Pr(t,e){if(!Array.isArray(t))return"";var r=[];for(let i=0;i<t.length;i++){var n=t[i];try{r.push(String(n))}catch{r.push("[value cannot be serialized]")}}return r.join(e)}s(Pr,"safeJoin");function Ce(t,e){return V(t)?Gn(e)?e.test(t):typeof e=="string"?t.indexOf(e)!==-1:!1:!1}s(Ce,"isMatchingPattern");function P(t,e,r){if(e in t){var n=t[e],i=r(n);if(typeof i=="function")try{Ir(i,n)}catch{}t[e]=i}}s(P,"fill");function ft(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,configurable:!0})}s(ft,"addNonEnumerableProperty");function Ir(t,e){var r=e.prototype||{};t.prototype=e.prototype=r,ft(t,"__sentry_original__",e)}s(Ir,"markFunctionWrapped");function Ye(t){return t.__sentry_original__}s(Ye,"getOriginalFunction");function wn(t){return Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&")}s(wn,"urlEncode");function Dr(t){if(Gt(t))return{message:t.message,name:t.name,stack:t.stack,...ba(t)};if(dt(t)){var e={type:t.type,target:Ea(t.target),currentTarget:Ea(t.currentTarget),...ba(t)};return typeof CustomEvent!="undefined"&&M(t,CustomEvent)&&(e.detail=t.detail),e}else return t}s(Dr,"convertToPlainObject");function Ea(t){try{return Un(t)?me(t):Object.prototype.toString.call(t)}catch{return"<unknown>"}}s(Ea,"serializeEventTarget");function ba(t){if(typeof t=="object"&&t!==null){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}else return{}}s(ba,"getOwnProperties");function Yn(t,e=40){var r=Object.keys(Dr(t));if(r.sort(),!r.length)return"[object has no keys]";if(r[0].length>=e)return ke(r[0],e);for(let i=r.length;i>0;i--){var n=r.slice(0,i).join(", ");if(!(n.length>e))return i===r.length?n:ke(n,e)}return""}s(Yn,"extractExceptionKeysForMessage");function A(t){var e=new Map;return Fn(t,e)}s(A,"dropUndefinedKeys");function Fn(t,e){if(W(t)){var r=e.get(t);if(r!==void 0)return r;var n={};e.set(t,n);for(var i of Object.keys(t))typeof t[i]!="undefined"&&(n[i]=Fn(t[i],e));return n}if(Array.isArray(t)){var r=e.get(t);if(r!==void 0)return r;var n=[];return e.set(t,n),t.forEach(c=>{n.push(Fn(c,e))}),n}return t}s(Fn,"_dropUndefinedKeys");var xo=50;function Or(...t){var e=t.sort((r,n)=>r[0]-n[0]).map(r=>r[1]);return(r,n=0)=>{var i=[];for(var a of r.split(`
`).slice(n))for(var o of e){var c=o(a);if(c){i.push(c);break}}return Ra(i)}}s(Or,"createStackParser");function Hn(t){return Array.isArray(t)?Or(...t):t}s(Hn,"stackParserFromStackParserOptions");function Ra(t){if(!t.length)return[];let e=t;var r=e[0].function||"",n=e[e.length-1].function||"";return(r.indexOf("captureMessage")!==-1||r.indexOf("captureException")!==-1)&&(e=e.slice(1)),n.indexOf("sentryWrapped")!==-1&&(e=e.slice(0,-1)),e.slice(0,xo).map(i=>({...i,filename:i.filename||e[0].filename,function:i.function||"?"})).reverse()}s(Ra,"stripSentryFramesAndReverse");var $n="<anonymous>";function j(t){try{return!t||typeof t!="function"?$n:t.name||$n}catch{return $n}}s(j,"getFunctionName");function lt(){if(!("fetch"in _()))return!1;try{return new Headers,new Request(""),new Response,!0}catch{return!1}}s(lt,"supportsFetch");function Ft(t){return t&&/^function fetch\(\)\s+\{\s+\[native code\]\s+\}$/.test(t.toString())}s(Ft,"isNativeFetch");function qn(){if(!lt())return!1;var t=_();if(Ft(t.fetch))return!0;let e=!1;var r=t.document;if(r&&typeof r.createElement=="function")try{var n=r.createElement("iframe");n.hidden=!0,r.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(e=Ft(n.contentWindow.fetch)),r.head.removeChild(n)}catch(i){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",i)}return e}s(qn,"supportsNativeFetch");function zn(){var t=_(),e=t.chrome,r=e&&e.app&&e.app.runtime,n="history"in t&&!!t.history.pushState&&!!t.history.replaceState;return!r&&n}s(zn,"supportsHistory");var R=_(),wt={},ka={};function Po(t){if(!ka[t])switch(ka[t]=!0,t){case"console":Io();break;case"dom":Bo();break;case"xhr":No();break;case"fetch":Do();break;case"history":Lo();break;case"error":jo();break;case"unhandledrejection":Fo();break;default:(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn("unknown instrumentation type:",t);return}}s(Po,"instrument");function x(t,e){wt[t]=wt[t]||[],wt[t].push(e),Po(t)}s(x,"addInstrumentationHandler");function J(t,e){if(!(!t||!wt[t]))for(var r of wt[t]||[])try{r(e)}catch(n){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${j(r)}
Error:`,n)}}s(J,"triggerHandlers");function Io(){"console"in R&&pt.forEach(function(t){t in R.console&&P(R.console,t,function(e){return function(...r){J("console",{args:r,level:t}),e&&e.apply(R.console,r)}})})}s(Io,"instrumentConsole");function Do(){!qn()||P(R,"fetch",function(t){return function(...e){var r={args:e,fetchData:{method:Oo(e),url:Mo(e)},startTimestamp:Date.now()};return J("fetch",{...r}),t.apply(R,e).then(n=>(J("fetch",{...r,endTimestamp:Date.now(),response:n}),n),n=>{throw J("fetch",{...r,endTimestamp:Date.now(),error:n}),n})}})}s(Do,"instrumentFetch");function Oo(t=[]){return"Request"in R&&M(t[0],Request)&&t[0].method?String(t[0].method).toUpperCase():t[1]&&t[1].method?String(t[1].method).toUpperCase():"GET"}s(Oo,"getFetchMethod");function Mo(t=[]){return typeof t[0]=="string"?t[0]:"Request"in R&&M(t[0],Request)?t[0].url:String(t[0])}s(Mo,"getFetchUrl");function No(){if("XMLHttpRequest"in R){var t=XMLHttpRequest.prototype;P(t,"open",function(e){return function(...r){var n=this,i=r[1],a=n.__sentry_xhr__={method:V(r[0])?r[0].toUpperCase():r[0],url:r[1]};V(i)&&a.method==="POST"&&i.match(/sentry_key/)&&(n.__sentry_own_request__=!0);var o=s(function(){if(n.readyState===4){try{a.status_code=n.status}catch{}J("xhr",{args:r,endTimestamp:Date.now(),startTimestamp:Date.now(),xhr:n})}},"onreadystatechangeHandler");return"onreadystatechange"in n&&typeof n.onreadystatechange=="function"?P(n,"onreadystatechange",function(c){return function(...u){return o(),c.apply(n,u)}}):n.addEventListener("readystatechange",o),e.apply(n,r)}}),P(t,"send",function(e){return function(...r){return this.__sentry_xhr__&&r[0]!==void 0&&(this.__sentry_xhr__.body=r[0]),J("xhr",{args:r,startTimestamp:Date.now(),xhr:this}),e.apply(this,r)}})}}s(No,"instrumentXHR");var Mr;function Lo(){if(!zn())return;var t=R.onpopstate;R.onpopstate=function(...r){var n=R.location.href,i=Mr;if(Mr=n,J("history",{from:i,to:n}),t)try{return t.apply(this,r)}catch{}};function e(r){return function(...n){var i=n.length>2?n[2]:void 0;if(i){var a=Mr,o=String(i);Mr=o,J("history",{from:a,to:o})}return r.apply(this,n)}}s(e,"historyReplacementFunction"),P(R.history,"pushState",e),P(R.history,"replaceState",e)}s(Lo,"instrumentHistory");var Ao=1e3,Nr,Lr;function Uo(t,e){if(!t||t.type!==e.type)return!0;try{if(t.target!==e.target)return!0}catch{}return!1}s(Uo,"shouldShortcircuitPreviousDebounce");function Go(t){if(t.type!=="keypress")return!1;try{var e=t.target;if(!e||!e.tagName)return!0;if(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)return!1}catch{}return!0}s(Go,"shouldSkipDOMEvent");function Ca(t,e=!1){return r=>{if(!(!r||Lr===r)&&!Go(r)){var n=r.type==="keypress"?"input":r.type;Nr===void 0?(t({event:r,name:n,global:e}),Lr=r):Uo(Lr,r)&&(t({event:r,name:n,global:e}),Lr=r),clearTimeout(Nr),Nr=R.setTimeout(()=>{Nr=void 0},Ao)}}}s(Ca,"makeDOMEventHandler");function Bo(){if("document"in R){var t=J.bind(null,"dom"),e=Ca(t,!0);R.document.addEventListener("click",e,!1),R.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(r=>{var n=R[r]&&R[r].prototype;!n||!n.hasOwnProperty||!n.hasOwnProperty("addEventListener")||(P(n,"addEventListener",function(i){return function(a,o,c){if(a==="click"||a=="keypress")try{var u=this,d=u.__sentry_instrumentation_handlers__=u.__sentry_instrumentation_handlers__||{},p=d[a]=d[a]||{refCount:0};if(!p.handler){var f=Ca(t);p.handler=f,i.call(this,a,f,c)}p.refCount+=1}catch{}return i.call(this,a,o,c)}}),P(n,"removeEventListener",function(i){return function(a,o,c){if(a==="click"||a=="keypress")try{var u=this,d=u.__sentry_instrumentation_handlers__||{},p=d[a];p&&(p.refCount-=1,p.refCount<=0&&(i.call(this,a,p.handler,c),p.handler=void 0,delete d[a]),Object.keys(d).length===0&&delete u.__sentry_instrumentation_handlers__)}catch{}return i.call(this,a,o,c)}}))})}}s(Bo,"instrumentDOM");var Vn=null;function jo(){Vn=R.onerror,R.onerror=function(t,e,r,n,i){return J("error",{column:n,error:i,line:r,msg:t,url:e}),Vn?Vn.apply(this,arguments):!1}}s(jo,"instrumentError");var Wn=null;function Fo(){Wn=R.onunhandledrejection,R.onunhandledrejection=function(t){return J("unhandledrejection",t),Wn?Wn.apply(this,arguments):!0}}s(Fo,"instrumentUnhandledRejection");function xa(){var t=typeof WeakSet=="function",e=t?new WeakSet:[];function r(i){if(t)return e.has(i)?!0:(e.add(i),!1);for(let o=0;o<e.length;o++){var a=e[o];if(a===i)return!0}return e.push(i),!1}s(r,"memoize");function n(i){if(t)e.delete(i);else for(let a=0;a<e.length;a++)if(e[a]===i){e.splice(a,1);break}}return s(n,"unmemoize"),[r,n]}s(xa,"memoBuilder");function U(){var t=_(),e=t.crypto||t.msCrypto;if(e!==void 0&&e.getRandomValues){var r=new Uint16Array(8);e.getRandomValues(r),r[3]=r[3]&4095|16384,r[4]=r[4]&16383|32768;var n=s(i=>{let a=i.toString(16);for(;a.length<4;)a=`0${a}`;return a},"pad");return n(r[0])+n(r[1])+n(r[2])+n(r[3])+n(r[4])+n(r[5])+n(r[6])+n(r[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,i=>{var a=Math.random()*16|0,o=i==="x"?a:a&3|8;return o.toString(16)})}s(U,"uuid4");function Yt(t){if(!t)return{};var e=t.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};var r=e[6]||"",n=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],relative:e[5]+r+n}}s(Yt,"parseUrl");function Pa(t){return t.exception&&t.exception.values?t.exception.values[0]:void 0}s(Pa,"getFirstException");function ie(t){let{message:e,event_id:r}=t;if(e)return e;var n=Pa(t);return n?n.type&&n.value?`${n.type}: ${n.value}`:n.type||n.value||r||"<unknown>":r||"<unknown>"}s(ie,"getEventDescription");function mt(t,e,r){var n=t.exception=t.exception||{},i=n.values=n.values||[],a=i[0]=i[0]||{};a.value||(a.value=e||""),a.type||(a.type=r||"Error")}s(mt,"addExceptionTypeValue");function he(t,e){var r=Pa(t);if(!!r){var n={type:"generic",handled:!0},i=r.mechanism;if(r.mechanism={...n,...i,...e},e&&"data"in e){var a={...i&&i.data,...e.data};r.mechanism.data=a}}}s(he,"addExceptionMechanism");function Ar(t){if(t&&t.__sentry_captured__)return!0;try{ft(t,"__sentry_captured__",!0)}catch{}return!1}s(Ar,"checkOrSetAlreadyCaught");function ge(t,e=1/0,r=1/0){try{return Jn("",t,e,r)}catch(n){return{ERROR:`**non-serializable** (${n})`}}}s(ge,"normalize");function Ur(t,e=3,r=100*1024){var n=ge(t,e);return $o(n)>r?Ur(t,e-1,r):n}s(Ur,"normalizeToSize");function Jn(t,e,r=1/0,n=1/0,i=xa()){let[a,o]=i;var c=e;if(c&&typeof c.toJSON=="function")try{return c.toJSON()}catch{}if(e===null||["number","boolean","string"].includes(typeof e)&&!jt(e))return e;var u=wo(t,e);if(!u.startsWith("[object "))return u;if(e.__sentry_skip_normalization__)return e;if(r===0)return u.replace("object ","");if(a(e))return"[Circular ~]";var d=Array.isArray(e)?[]:{};let p=0;var f=Dr(e);for(var h in f)if(!!Object.prototype.hasOwnProperty.call(f,h)){if(p>=n){d[h]="[MaxProperties ~]";break}var v=f[h];d[h]=Jn(h,v,r-1,n,i),p+=1}return o(e),d}s(Jn,"visit");function wo(t,e){try{return t==="domain"&&e&&typeof e=="object"&&e._events?"[Domain]":t==="domainEmitter"?"[DomainEmitter]":typeof global!="undefined"&&e===global?"[Global]":typeof window!="undefined"&&e===window?"[Window]":typeof document!="undefined"&&e===document?"[Document]":Bn(e)?"[SyntheticEvent]":typeof e=="number"&&e!==e?"[NaN]":e===void 0?"[undefined]":typeof e=="function"?`[Function: ${j(e)}]`:typeof e=="symbol"?`[${String(e)}]`:typeof e=="bigint"?`[BigInt: ${String(e)}]`:`[object ${Object.getPrototypeOf(e).constructor.name}]`}catch(r){return`**non-serializable** (${r})`}}s(wo,"stringifyValue");function Yo(t){return~-encodeURI(t).split(/%..|./).length}s(Yo,"utf8Length");function $o(t){return Yo(JSON.stringify(t))}s($o,"jsonSize");var _e;(function(t){var e=0;t[t.PENDING=e]="PENDING";var r=1;t[t.RESOLVED=r]="RESOLVED";var n=2;t[t.REJECTED=n]="REJECTED"})(_e||(_e={}));function G(t){return new k(e=>{e(t)})}s(G,"resolvedSyncPromise");function ht(t){return new k((e,r)=>{r(t)})}s(ht,"rejectedSyncPromise");var k=class{__init(){this._state=_e.PENDING}__init2(){this._handlers=[]}constructor(e){k.prototype.__init.call(this),k.prototype.__init2.call(this),k.prototype.__init3.call(this),k.prototype.__init4.call(this),k.prototype.__init5.call(this),k.prototype.__init6.call(this);try{e(this._resolve,this._reject)}catch(r){this._reject(r)}}then(e,r){return new k((n,i)=>{this._handlers.push([!1,a=>{if(!e)n(a);else try{n(e(a))}catch(o){i(o)}},a=>{if(!r)i(a);else try{n(r(a))}catch(o){i(o)}}]),this._executeHandlers()})}catch(e){return this.then(r=>r,e)}finally(e){return new k((r,n)=>{let i,a;return this.then(o=>{a=!1,i=o,e&&e()},o=>{a=!0,i=o,e&&e()}).then(()=>{if(a){n(i);return}r(i)})})}__init3(){this._resolve=e=>{this._setResult(_e.RESOLVED,e)}}__init4(){this._reject=e=>{this._setResult(_e.REJECTED,e)}}__init5(){this._setResult=(e,r)=>{if(this._state===_e.PENDING){if(Fe(r)){r.then(this._resolve,this._reject);return}this._state=e,this._value=r,this._executeHandlers()}}}__init6(){this._executeHandlers=()=>{if(this._state!==_e.PENDING){var e=this._handlers.slice();this._handlers=[],e.forEach(r=>{r[0]||(this._state===_e.RESOLVED&&r[1](this._value),this._state===_e.REJECTED&&r[2](this._value),r[0]=!0)})}}}};s(k,"SyncPromise");function Kn(t){var e=[];function r(){return t===void 0||e.length<t}s(r,"isReady");function n(o){return e.splice(e.indexOf(o),1)[0]}s(n,"remove");function i(o){if(!r())return ht(new b("Not adding Promise due to buffer limit reached."));var c=o();return e.indexOf(c)===-1&&e.push(c),c.then(()=>n(c)).then(null,()=>n(c).then(null,()=>{})),c}s(i,"add");function a(o){return new k((c,u)=>{let d=e.length;if(!d)return c(!0);var p=setTimeout(()=>{o&&o>0&&c(!1)},o);e.forEach(f=>{G(f).then(()=>{--d||(clearTimeout(p),c(!0))},u)})})}return s(a,"drain"),{$:e,add:i,drain:a}}s(Kn,"makePromiseBuffer");function B(t,e){return t!=null?t:e()}s(B,"_nullishCoalesce");function Xn(t){let e,r=t[0],n=1;for(;n<t.length;){var i=t[n],a=t[n+1];if(n+=2,(i==="optionalAccess"||i==="optionalCall")&&r==null)return;i==="access"||i==="optionalAccess"?(e=r,r=a(r)):(i==="call"||i==="optionalCall")&&(r=a((...o)=>r.call(e,...o)),e=void 0)}return r}s(Xn,"_optionalChain");var Ia=["fatal","error","warning","log","info","debug"];function Qn(t){return t==="warn"?"warning":Ia.includes(t)?t:"log"}s(Qn,"severityLevelFromString");var ei={nowSeconds:()=>Date.now()/1e3};function Ho(){let{performance:t}=_();if(!(!t||!t.now)){var e=Date.now()-t.now();return{now:()=>t.now(),timeOrigin:e}}}s(Ho,"getBrowserPerformance");function qo(){try{var t=z(module,"perf_hooks");return t.performance}catch{return}}s(qo,"getNodePerformance");var Zn=le()?qo():Ho(),Da=Zn===void 0?ei:{nowSeconds:()=>(Zn.timeOrigin+Zn.now())/1e3},ve=ei.nowSeconds.bind(ei),Ht=Da.nowSeconds.bind(Da),xe=Ht;var $t,$e=(()=>{let{performance:t}=_();if(!t||!t.now){$t="none";return}var e=3600*1e3,r=t.now(),n=Date.now(),i=t.timeOrigin?Math.abs(t.timeOrigin+r-n):e,a=i<e,o=t.timing&&t.timing.navigationStart,c=typeof o=="number",u=c?Math.abs(o+r-n):e,d=u<e;return a||d?i<=u?($t="timeOrigin",t.timeOrigin):($t="navigationStart",o):($t="dateNow",n)})();var Oa=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function ti(t){var e=t.match(Oa);if(e){let r;return e[3]==="1"?r=!0:e[3]==="0"&&(r=!1),{traceId:e[1],parentSampled:r,parentSpanId:e[2]}}}s(ti,"extractTraceparentData");function Pe(t,e=[]){return[t,e]}s(Pe,"createEnvelope");function ni(t,e){let[r,n]=t;return[r,[...n,e]]}s(ni,"addItemToEnvelope");function Gr(t,e){var r=t[1];r.forEach(n=>{var i=n[0].type;e(n,i)})}s(Gr,"forEachEnvelopeItem");function ri(t,e){var r=e||new TextEncoder;return r.encode(t)}s(ri,"encodeUTF8");function qt(t,e){let[r,n]=t,i=JSON.stringify(r);function a(c){typeof i=="string"?i=typeof c=="string"?i+c:[ri(i,e),c]:i.push(typeof c=="string"?ri(c,e):c)}s(a,"append");for(var o of n){let[c,u]=o;a(`
${JSON.stringify(c)}
`),a(typeof u=="string"||u instanceof Uint8Array?u:JSON.stringify(u))}return typeof i=="string"?i:zo(i)}s(qt,"serializeEnvelope");function zo(t){var e=t.reduce((a,o)=>a+o.length,0),r=new Uint8Array(e);let n=0;for(var i of t)r.set(i,n),n+=i.length;return r}s(zo,"concatBuffers");function ii(t,e){var r=typeof t.data=="string"?ri(t.data,e):t.data;return[A({type:"attachment",length:r.length,filename:t.filename,content_type:t.contentType,attachment_type:t.attachmentType}),r]}s(ii,"createAttachmentEnvelopeItem");var Vo={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default"};function Br(t){return Vo[t]}s(Br,"envelopeItemTypeToDataCategory");function ai(t,e,r){var n=[{type:"client_report"},{timestamp:r||ve(),discarded_events:t}];return Pe(e?{dsn:e}:{},[n])}s(ai,"createClientReportEnvelope");var Ma=6e4;function Na(t,e=Date.now()){var r=parseInt(`${t}`,10);if(!isNaN(r))return r*1e3;var n=Date.parse(`${t}`);return isNaN(n)?Ma:n-e}s(Na,"parseRetryAfterHeader");function La(t,e){return t[e]||t.all||0}s(La,"disabledUntil");function si(t,e,r=Date.now()){return La(t,e)>r}s(si,"isRateLimited");function oi(t,{statusCode:e,headers:r},n=Date.now()){var i={...t},a=r&&r["x-sentry-rate-limits"],o=r&&r["retry-after"];if(a)for(var c of a.trim().split(",")){let[f,h]=c.split(":",2);var u=parseInt(f,10),d=(isNaN(u)?60:u)*1e3;if(!h)i.all=n+d;else for(var p of h.split(";"))i[p]=n+d}else o?i.all=n+Na(o,n):e===429&&(i.all=n+60*1e3);return i}s(oi,"updateRateLimits");var Ie="baggage",Aa="sentry-",Ua=/^sentry-/,Ga=8192;function jr(t,e="",r=!0){return[{...t},e,r]}s(jr,"createBaggage");function Fr(t,e,r){wr(t)&&(t[0][e]=r)}s(Fr,"setBaggageValue");function zt(t){return Object.keys(t[0]).length===0}s(zt,"isSentryBaggageEmpty");function ci(t){return t[0]}s(ci,"getSentryBaggageItems");function Ba(t){return t[1]}s(Ba,"getThirdPartyBaggage");function wr(t){return t[2]}s(wr,"isBaggageMutable");function Yr(t){t[2]=!1}s(Yr,"setBaggageImmutable");function ja(t){return Object.keys(t[0]).reduce((e,r)=>{var n=t[0][r],i=`${Aa}${encodeURIComponent(r)}=${encodeURIComponent(n)}`,a=e===""?i:`${e},${i}`;return a.length>Ga?((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(`Not adding key: ${r} with val: ${n} to baggage due to exceeding baggage size limits.`),e):a},t[1])}s(ja,"serializeBaggage");function ui(t){return t.split(",").reduce(([e,r],n)=>{let[i,a]=n.split("=");if(Ua.test(i)){var o=decodeURIComponent(i.split("-")[1]);return[{...e,[o]:decodeURIComponent(a)},r,!0]}else return[e,r===""?n:`${r},${n}`,!0]},[{},"",!0])}s(ui,"parseBaggageString");function He(t,e){if(!t&&!e)return"";var r=e&&ui(e)||void 0,n=r&&Ba(r),i=jr(t&&t[0]||{},n||t&&t[1]||"");return ja(i)}s(He,"mergeAndSerializeBaggage");function di(t,e){var r=ui(t||"");return(!zt(r)||e&&zt(r))&&Yr(r),r}s(di,"parseBaggageSetMutability");function pi(t){var e=Ht(),r={sid:U(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>Wo(r)};return t&&ae(r,t),r}s(pi,"makeSession");function ae(t,e={}){if(e.user&&(!t.ipAddress&&e.user.ip_address&&(t.ipAddress=e.user.ip_address),!t.did&&!e.did&&(t.did=e.user.id||e.user.email||e.user.username)),t.timestamp=e.timestamp||Ht(),e.ignoreDuration&&(t.ignoreDuration=e.ignoreDuration),e.sid&&(t.sid=e.sid.length===32?e.sid:U()),e.init!==void 0&&(t.init=e.init),!t.did&&e.did&&(t.did=`${e.did}`),typeof e.started=="number"&&(t.started=e.started),t.ignoreDuration)t.duration=void 0;else if(typeof e.duration=="number")t.duration=e.duration;else{var r=t.timestamp-t.started;t.duration=r>=0?r:0}e.release&&(t.release=e.release),e.environment&&(t.environment=e.environment),!t.ipAddress&&e.ipAddress&&(t.ipAddress=e.ipAddress),!t.userAgent&&e.userAgent&&(t.userAgent=e.userAgent),typeof e.errors=="number"&&(t.errors=e.errors),e.status&&(t.status=e.status)}s(ae,"updateSession");function fi(t,e){let r={};e?r={status:e}:t.status==="ok"&&(r={status:"exited"}),ae(t,r)}s(fi,"closeSession");function Wo(t){return A({sid:`${t.sid}`,init:t.init,started:new Date(t.started*1e3).toISOString(),timestamp:new Date(t.timestamp*1e3).toISOString(),status:t.status,errors:t.errors,did:typeof t.did=="number"||typeof t.did=="string"?`${t.did}`:void 0,duration:t.duration,attrs:{release:t.release,environment:t.environment,ip_address:t.ipAddress,user_agent:t.userAgent}})}s(Wo,"sessionToJSON");var Fa=100,E=class{constructor(){E.prototype.__init.call(this),E.prototype.__init2.call(this),E.prototype.__init3.call(this),E.prototype.__init4.call(this),E.prototype.__init5.call(this),E.prototype.__init6.call(this),E.prototype.__init7.call(this),E.prototype.__init8.call(this),E.prototype.__init9.call(this),E.prototype.__init10.call(this)}__init(){this._notifyingListeners=!1}__init2(){this._scopeListeners=[]}__init3(){this._eventProcessors=[]}__init4(){this._breadcrumbs=[]}__init5(){this._user={}}__init6(){this._tags={}}__init7(){this._extra={}}__init8(){this._contexts={}}__init9(){this._attachments=[]}__init10(){this._sdkProcessingMetadata={}}static clone(e){var r=new E;return e&&(r._breadcrumbs=[...e._breadcrumbs],r._tags={...e._tags},r._extra={...e._extra},r._contexts={...e._contexts},r._user=e._user,r._level=e._level,r._span=e._span,r._session=e._session,r._transactionName=e._transactionName,r._fingerprint=e._fingerprint,r._eventProcessors=[...e._eventProcessors],r._requestSession=e._requestSession,r._attachments=[...e._attachments]),r}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{},this._session&&ae(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,r){return this._tags={...this._tags,[e]:r},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,r){return this._extra={...this._extra,[e]:r},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,r){return r===null?delete this._contexts[e]:this._contexts={...this._contexts,[e]:r},this._notifyScopeListeners(),this}setSpan(e){return this._span=e,this._notifyScopeListeners(),this}getSpan(){return this._span}getTransaction(){var e=this.getSpan();return e&&e.transaction}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;if(typeof e=="function"){var r=e(this);return r instanceof E?r:this}return e instanceof E?(this._tags={...this._tags,...e._tags},this._extra={...this._extra,...e._extra},this._contexts={...this._contexts,...e._contexts},e._user&&Object.keys(e._user).length&&(this._user=e._user),e._level&&(this._level=e._level),e._fingerprint&&(this._fingerprint=e._fingerprint),e._requestSession&&(this._requestSession=e._requestSession)):W(e)&&(e=e,this._tags={...this._tags,...e.tags},this._extra={...this._extra,...e.extra},this._contexts={...this._contexts,...e.contexts},e.user&&(this._user=e.user),e.level&&(this._level=e.level),e.fingerprint&&(this._fingerprint=e.fingerprint),e.requestSession&&(this._requestSession=e.requestSession)),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this._attachments=[],this}addBreadcrumb(e,r){var n=typeof r=="number"?Math.min(r,Fa):Fa;if(n<=0)return this;var i={timestamp:ve(),...e};return this._breadcrumbs=[...this._breadcrumbs,i].slice(-n),this._notifyScopeListeners(),this}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}getAttachments(){return this._attachments}clearAttachments(){return this._attachments=[],this}applyToEvent(e,r={}){if(this._extra&&Object.keys(this._extra).length&&(e.extra={...this._extra,...e.extra}),this._tags&&Object.keys(this._tags).length&&(e.tags={...this._tags,...e.tags}),this._user&&Object.keys(this._user).length&&(e.user={...this._user,...e.user}),this._contexts&&Object.keys(this._contexts).length&&(e.contexts={...this._contexts,...e.contexts}),this._level&&(e.level=this._level),this._transactionName&&(e.transaction=this._transactionName),this._span){e.contexts={trace:this._span.getTraceContext(),...e.contexts};var n=this._span.transaction&&this._span.transaction.name;n&&(e.tags={transaction:n,...e.tags})}return this._applyFingerprint(e),e.breadcrumbs=[...e.breadcrumbs||[],...this._breadcrumbs],e.breadcrumbs=e.breadcrumbs.length>0?e.breadcrumbs:void 0,e.sdkProcessingMetadata=this._sdkProcessingMetadata,this._notifyEventProcessors([...wa(),...this._eventProcessors],e,r)}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...e},this}_notifyEventProcessors(e,r,n,i=0){return new k((a,o)=>{var c=e[i];if(r===null||typeof c!="function")a(r);else{var u=c({...r},n);(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&c.id&&u===null&&l.log(`Event processor "${c.id}" dropped event`),Fe(u)?u.then(d=>this._notifyEventProcessors(e,d,n,i+1).then(a)).then(null,o):this._notifyEventProcessors(e,u,n,i+1).then(a).then(null,o)}})}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}_applyFingerprint(e){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],this._fingerprint&&(e.fingerprint=e.fingerprint.concat(this._fingerprint)),e.fingerprint&&!e.fingerprint.length&&delete e.fingerprint}};s(E,"Scope");function wa(){return je("globalEventProcessors",()=>[])}s(wa,"getGlobalEventProcessors");function Se(t){wa().push(t)}s(Se,"addGlobalEventProcessor");var li=4,Jo=100,X=class{__init(){this._stack=[{}]}constructor(e,r=new E,n=li){this._version=n,X.prototype.__init.call(this),this.getStackTop().scope=r,e&&this.bindClient(e)}isOlderThan(e){return this._version<e}bindClient(e){var r=this.getStackTop();r.client=e,e&&e.setupIntegrations&&e.setupIntegrations()}pushScope(){var e=E.clone(this.getScope());return this.getStack().push({client:this.getClient(),scope:e}),e}popScope(){return this.getStack().length<=1?!1:!!this.getStack().pop()}withScope(e){var r=this.pushScope();try{e(r)}finally{this.popScope()}}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getStack(){return this._stack}getStackTop(){return this._stack[this._stack.length-1]}captureException(e,r){var n=this._lastEventId=r&&r.event_id?r.event_id:U(),i=new Error("Sentry syntheticException");return this._withClient((a,o)=>{a.captureException(e,{originalException:e,syntheticException:i,...r,event_id:n},o)}),n}captureMessage(e,r,n){var i=this._lastEventId=n&&n.event_id?n.event_id:U(),a=new Error(e);return this._withClient((o,c)=>{o.captureMessage(e,r,{originalException:e,syntheticException:a,...n,event_id:i},c)}),i}captureEvent(e,r){var n=r&&r.event_id?r.event_id:U();return e.type!=="transaction"&&(this._lastEventId=n),this._withClient((i,a)=>{i.captureEvent(e,{...r,event_id:n},a)}),n}lastEventId(){return this._lastEventId}addBreadcrumb(e,r){let{scope:n,client:i}=this.getStackTop();if(!n||!i)return;let{beforeBreadcrumb:a=null,maxBreadcrumbs:o=Jo}=i.getOptions&&i.getOptions()||{};if(!(o<=0)){var c=ve(),u={timestamp:c,...e},d=a?xr(()=>a(u,r)):u;d!==null&&n.addBreadcrumb(d,o)}}setUser(e){var r=this.getScope();r&&r.setUser(e)}setTags(e){var r=this.getScope();r&&r.setTags(e)}setExtras(e){var r=this.getScope();r&&r.setExtras(e)}setTag(e,r){var n=this.getScope();n&&n.setTag(e,r)}setExtra(e,r){var n=this.getScope();n&&n.setExtra(e,r)}setContext(e,r){var n=this.getScope();n&&n.setContext(e,r)}configureScope(e){let{scope:r,client:n}=this.getStackTop();r&&n&&e(r)}run(e){var r=Vt(this);try{e(this)}finally{Vt(r)}}getIntegration(e){var r=this.getClient();if(!r)return null;try{return r.getIntegration(e)}catch{return(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(`Cannot retrieve integration ${e.id} from the current Hub`),null}}startTransaction(e,r){return this._callExtensionMethod("startTransaction",e,r)}traceHeaders(){return this._callExtensionMethod("traceHeaders")}captureSession(e=!1){if(e)return this.endSession();this._sendSessionUpdate()}endSession(){var e=this.getStackTop(),r=e&&e.scope,n=r&&r.getSession();n&&fi(n),this._sendSessionUpdate(),r&&r.setSession()}startSession(e){let{scope:r,client:n}=this.getStackTop(),{release:i,environment:a}=n&&n.getOptions()||{};var o=_();let{userAgent:c}=o.navigator||{};var u=pi({release:i,environment:a,...r&&{user:r.getUser()},...c&&{userAgent:c},...e});if(r){var d=r.getSession&&r.getSession();d&&d.status==="ok"&&ae(d,{status:"exited"}),this.endSession(),r.setSession(u)}return u}_sendSessionUpdate(){let{scope:e,client:r}=this.getStackTop();if(!!e){var n=e.getSession();n&&r&&r.captureSession&&r.captureSession(n)}}_withClient(e){let{scope:r,client:n}=this.getStackTop();n&&e(n,r)}_callExtensionMethod(e,...r){var n=De(),i=n.__SENTRY__;if(i&&i.extensions&&typeof i.extensions[e]=="function")return i.extensions[e].apply(this,r);(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(`Extension method ${e} couldn't be found, doing nothing.`)}};s(X,"Hub");function De(){var t=_();return t.__SENTRY__=t.__SENTRY__||{extensions:{},hub:void 0},t}s(De,"getMainCarrier");function Vt(t){var e=De(),r=K(e);return $r(e,t),r}s(Vt,"makeMain");function S(){var t=De();return(!Ya(t)||K(t).isOlderThan(li))&&$r(t,new X),le()?Ko(t):K(t)}s(S,"getCurrentHub");function Ko(t){try{var e=De().__SENTRY__,r=e&&e.extensions&&e.extensions.domain&&e.extensions.domain.active;if(!r)return K(t);if(!Ya(r)||K(r).isOlderThan(li)){var n=K(t).getStackTop();$r(r,new X(n.client,E.clone(n.scope)))}return K(r)}catch{return K(t)}}s(Ko,"getHubFromActiveDomain");function Ya(t){return!!(t&&t.__SENTRY__&&t.__SENTRY__.hub)}s(Ya,"hasHubOnCarrier");function K(t){return je("hub",()=>new X,t)}s(K,"getHubFromCarrier");function $r(t,e){if(!t)return!1;var r=t.__SENTRY__=t.__SENTRY__||{};return r.hub=e,!0}s($r,"setHubOnCarrier");function Wt(t,e){return S().captureException(t,{captureContext:e})}s(Wt,"captureException");function gt(t,e){S().setContext(t,e)}s(gt,"setContext");function Jt(t){S().withScope(t)}s(Jt,"withScope");var Xo="7";function Qo(t){var e=t.protocol?`${t.protocol}:`:"",r=t.port?`:${t.port}`:"";return`${e}//${t.host}${r}${t.path?`/${t.path}`:""}/api/`}s(Qo,"getBaseApiEndpoint");function Zo(t){return`${Qo(t)}${t.projectId}/envelope/`}s(Zo,"_getIngestEndpoint");function ec(t){return wn({sentry_key:t.publicKey,sentry_version:Xo})}s(ec,"_encodedAuth");function Kt(t,e){return e||`${Zo(t)}?${ec(t)}`}s(Kt,"getEnvelopeEndpointWithUrlEncodedAuth");function Za(t){if(!t||!t.sdk)return;let{name:e,version:r}=t.sdk;return{name:e,version:r}}s(Za,"getSdkMetadataForEnvelopeHeader");function tc(t,e){return e&&(t.sdk=t.sdk||{},t.sdk.name=t.sdk.name||e.name,t.sdk.version=t.sdk.version||e.version,t.sdk.integrations=[...t.sdk.integrations||[],...e.integrations||[]],t.sdk.packages=[...t.sdk.packages||[],...e.packages||[]]),t}s(tc,"enhanceEventWithSdkInfo");function es(t,e,r,n){var i=Za(r),a={sent_at:new Date().toISOString(),...i&&{sdk:i},...!!n&&{dsn:we(e)}},o="aggregates"in t?[{type:"sessions"},t]:[{type:"session"},t];return Pe(a,[o])}s(es,"createSessionEnvelope");function ts(t,e,r,n){var i=Za(r),a=t.type||"event";let{transactionSampling:o}=t.sdkProcessingMetadata||{},{method:c,rate:u}=o||{};tc(t,r&&r.sdk),delete t.sdkProcessingMetadata;var d=rc(t,i,n,e),p=[{type:a,sample_rates:[{id:c,rate:u}]},t];return Pe(d,[p])}s(ts,"createEventEnvelope");function rc(t,e,r,n){var i=t.contexts&&t.contexts.baggage;let{environment:a,release:o,transaction:c,userid:u,usersegment:d}=i||{};return{event_id:t.event_id,sent_at:new Date().toISOString(),...e&&{sdk:e},...!!r&&{dsn:we(n)},...t.type==="transaction"&&t.contexts&&t.contexts.trace&&{trace:A({trace_id:t.contexts.trace.trace_id,public_key:n.publicKey,environment:a,release:o,transaction:c,...(u||d)&&{user:{id:u,segment:d}}})}}}s(rc,"createEventEnvelopeHeaders");var rs=[];function ns(t){return t.reduce((e,r)=>(e.every(n=>r.name!==n.name)&&e.push(r),e),[])}s(ns,"filterDuplicates");function mi(t){var e=t.defaultIntegrations&&[...t.defaultIntegrations]||[],r=t.integrations;let n=[...ns(e)];Array.isArray(r)?n=[...n.filter(o=>r.every(c=>c.name!==o.name)),...ns(r)]:typeof r=="function"&&(n=r(n),n=Array.isArray(n)?n:[n]);var i=n.map(o=>o.name),a="Debug";return i.indexOf(a)!==-1&&n.push(...n.splice(i.indexOf(a),1)),n}s(mi,"getIntegrationsToSetup");function is(t){var e={};return t.forEach(r=>{e[r.name]=r,rs.indexOf(r.name)===-1&&(r.setupOnce(Se,S),rs.push(r.name),(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`Integration installed: ${r.name}`))}),e}s(is,"setupIntegrations");var as="Not capturing exception because it's already been captured.",Q=class{__init(){this._integrations={}}__init2(){this._integrationsInitialized=!1}__init3(){this._numProcessing=0}__init4(){this._outcomes={}}constructor(e){if(Q.prototype.__init.call(this),Q.prototype.__init2.call(this),Q.prototype.__init3.call(this),Q.prototype.__init4.call(this),this._options=e,e.dsn){this._dsn=Cr(e.dsn);var r=Kt(this._dsn,e.tunnel);this._transport=e.transport({recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:r})}else(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn("No DSN provided, client will not do anything.")}captureException(e,r,n){if(Ar(e)){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(as);return}let i=r&&r.event_id;return this._process(this.eventFromException(e,r).then(a=>this._captureEvent(a,r,n)).then(a=>{i=a})),i}captureMessage(e,r,n,i){let a=n&&n.event_id;var o=ut(e)?this.eventFromMessage(String(e),r,n):this.eventFromException(e,n);return this._process(o.then(c=>this._captureEvent(c,n,i)).then(c=>{a=c})),a}captureEvent(e,r,n){if(r&&r.originalException&&Ar(r.originalException)){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(as);return}let i=r&&r.event_id;return this._process(this._captureEvent(e,r,n).then(a=>{i=a})),i}captureSession(e){if(!this._isEnabled()){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn("SDK not enabled, will not capture session.");return}typeof e.release!="string"?(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),ae(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getTransport(){return this._transport}flush(e){var r=this._transport;return r?this._isClientDoneProcessing(e).then(n=>r.flush(e).then(i=>n&&i)):G(!0)}close(e){return this.flush(e).then(r=>(this.getOptions().enabled=!1,r))}setupIntegrations(){this._isEnabled()&&!this._integrationsInitialized&&(this._integrations=is(this._options.integrations),this._integrationsInitialized=!0)}getIntegrationById(e){return this._integrations[e]}getIntegration(e){try{return this._integrations[e.id]||null}catch{return(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(`Cannot retrieve integration ${e.id} from the current Client`),null}}sendEvent(e,r={}){if(this._dsn){let i=ts(e,this._dsn,this._options._metadata,this._options.tunnel);for(var n of r.attachments||[])i=ni(i,ii(n,Xn([this,"access",a=>a._options,"access",a=>a.transportOptions,"optionalAccess",a=>a.textEncoder])));this._sendEnvelope(i)}}sendSession(e){if(this._dsn){var r=es(e,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(r)}}recordDroppedEvent(e,r){if(this._options.sendClientReports){var n=`${e}:${r}`;(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`Adding outcome: "${n}"`),this._outcomes[n]=this._outcomes[n]+1||1}}_updateSessionFromEvent(e,r){let n=!1,i=!1;var a=r.exception&&r.exception.values;if(a){i=!0;for(var o of a){var c=o.mechanism;if(c&&c.handled===!1){n=!0;break}}}var u=e.status==="ok",d=u&&e.errors===0||u&&n;d&&(ae(e,{...n&&{status:"crashed"},errors:e.errors||Number(i||n)}),this.captureSession(e))}_isClientDoneProcessing(e){return new k(r=>{let n=0;var i=1,a=setInterval(()=>{this._numProcessing==0?(clearInterval(a),r(!0)):(n+=i,e&&n>=e&&(clearInterval(a),r(!1)))},i)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._dsn!==void 0}_prepareEvent(e,r,n){let{normalizeDepth:i=3,normalizeMaxBreadth:a=1e3}=this.getOptions();var o={...e,event_id:e.event_id||r.event_id||U(),timestamp:e.timestamp||ve()};this._applyClientOptions(o),this._applyIntegrationsMetadata(o);let c=n;r.captureContext&&(c=E.clone(c).update(r.captureContext));let u=G(o);if(c){var d=[...r.attachments||[],...c.getAttachments()];d.length&&(r.attachments=d),u=c.applyToEvent(o,r)}return u.then(p=>typeof i=="number"&&i>0?this._normalizeEvent(p,i,a):p)}_normalizeEvent(e,r,n){if(!e)return null;var i={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map(a=>({...a,...a.data&&{data:ge(a.data,r,n)}}))},...e.user&&{user:ge(e.user,r,n)},...e.contexts&&{contexts:ge(e.contexts,r,n)},...e.extra&&{extra:ge(e.extra,r,n)}};return e.contexts&&e.contexts.trace&&i.contexts&&(i.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(i.contexts.trace.data=ge(e.contexts.trace.data,r,n))),e.spans&&(i.spans=e.spans.map(a=>(a.data&&(a.data=ge(a.data,r,n)),a))),i}_applyClientOptions(e){var r=this.getOptions();let{environment:n,release:i,dist:a,maxValueLength:o=250}=r;"environment"in e||(e.environment="environment"in r?n:"production"),e.release===void 0&&i!==void 0&&(e.release=i),e.dist===void 0&&a!==void 0&&(e.dist=a),e.message&&(e.message=ke(e.message,o));var c=e.exception&&e.exception.values&&e.exception.values[0];c&&c.value&&(c.value=ke(c.value,o));var u=e.request;u&&u.url&&(u.url=ke(u.url,o))}_applyIntegrationsMetadata(e){var r=Object.keys(this._integrations);r.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...r])}_captureEvent(e,r={},n){return this._processEvent(e,r,n).then(i=>i.event_id,i=>{(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(i)})}_processEvent(e,r,n){let{beforeSend:i,sampleRate:a}=this.getOptions();if(!this._isEnabled())return ht(new b("SDK not enabled, will not capture event."));var o=e.type==="transaction";return!o&&typeof a=="number"&&Math.random()>a?(this.recordDroppedEvent("sample_rate","error"),ht(new b(`Discarding event because it's not included in the random sample (sampling rate = ${a})`))):this._prepareEvent(e,r,n).then(c=>{if(c===null)throw this.recordDroppedEvent("event_processor",e.type||"error"),new b("An event processor returned null, will not send event.");var u=r.data&&r.data.__sentry__===!0;if(u||o||!i)return c;var d=i(c,r);return nc(d)}).then(c=>{if(c===null)throw this.recordDroppedEvent("before_send",e.type||"error"),new b("`beforeSend` returned `null`, will not send event.");var u=n&&n.getSession();return!o&&u&&this._updateSessionFromEvent(u,c),this.sendEvent(c,r),c}).then(null,c=>{throw c instanceof b?c:(this.captureException(c,{data:{__sentry__:!0},originalException:c}),new b(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${c}`))})}_process(e){this._numProcessing+=1,e.then(r=>(this._numProcessing-=1,r),r=>(this._numProcessing-=1,r))}_sendEnvelope(e){this._transport&&this._dsn?this._transport.send(e).then(null,r=>{(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.error("Error while sending event:",r)}):(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.error("Transport disabled")}_clearOutcomes(){var e=this._outcomes;return this._outcomes={},Object.keys(e).map(r=>{let[n,i]=r.split(":");return{reason:n,category:i,quantity:e[r]}})}};s(Q,"BaseClient");function nc(t){var e="`beforeSend` method has to return `null` or a valid event.";if(Fe(t))return t.then(r=>{if(!(W(r)||r===null))throw new b(e);return r},r=>{throw new b(`beforeSend rejected with ${r}`)});if(!(W(t)||t===null))throw new b(e);return t}s(nc,"_ensureBeforeSendRv");function hi(t,e){e.debug===!0&&(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__?l.enable():console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle."));var r=S(),n=r.getScope();n&&n.update(e.initialScope);var i=new t(e);r.bindClient(i)}s(hi,"initAndBind");var ic=30;function _t(t,e,r=Kn(t.bufferSize||ic)){let n={};var i=s(o=>r.drain(o),"flush");function a(o){var c=[];if(Gr(o,(f,h)=>{var v=Br(h);si(n,v)?t.recordDroppedEvent("ratelimit_backoff",v):c.push(f)}),c.length===0)return G();var u=Pe(o[0],c),d=s(f=>{Gr(u,(h,v)=>{t.recordDroppedEvent(f,Br(v))})},"recordEnvelopeLoss"),p=s(()=>e({body:qt(u,t.textEncoder)}).then(f=>{f.statusCode!==void 0&&(f.statusCode<200||f.statusCode>=300)&&(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(`Sentry responded with status code ${f.statusCode} to sent event.`),n=oi(n,f)},f=>{(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.error("Failed while sending event:",f),d("network_error")}),"requestTask");return r.add(p).then(f=>f,f=>{if(f instanceof b)return(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.error("Skipped sending event due to full buffer"),d("queue_overflow"),G();throw f})}return s(a,"send"),{send:a,flush:i}}s(_t,"createTransport");var Xt="7.2.0";var qe={};Xe(qe,{FunctionToString:()=>se,InboundFilters:()=>Z});var ss,se=class{constructor(){se.prototype.__init.call(this)}static __initStatic(){this.id="FunctionToString"}__init(){this.name=se.id}setupOnce(){ss=Function.prototype.toString,Function.prototype.toString=function(...e){var r=Ye(this)||this;return ss.apply(r,e)}}};s(se,"FunctionToString");se.__initStatic();var ac=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/],Z=class{static __initStatic(){this.id="InboundFilters"}__init(){this.name=Z.id}constructor(e={}){this._options=e,Z.prototype.__init.call(this)}setupOnce(e,r){var n=s(i=>{var a=r();if(a){var o=a.getIntegration(Z);if(o){var c=a.getClient(),u=c?c.getOptions():{},d=sc(o._options,u);return oc(i,d)?null:i}}return i},"eventProcess");n.id=this.name,e(n)}};s(Z,"InboundFilters");Z.__initStatic();function sc(t={},e={}){return{allowUrls:[...t.allowUrls||[],...e.allowUrls||[]],denyUrls:[...t.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...t.ignoreErrors||[],...e.ignoreErrors||[],...ac],ignoreInternal:t.ignoreInternal!==void 0?t.ignoreInternal:!0}}s(sc,"_mergeOptions");function oc(t,e){return e.ignoreInternal&&fc(t)?((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(`Event dropped due to being internal Sentry Error.
Event: ${ie(t)}`),!0):cc(t,e.ignoreErrors)?((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${ie(t)}`),!0):uc(t,e.denyUrls)?((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${ie(t)}.
Url: ${Hr(t)}`),!0):dc(t,e.allowUrls)?!1:((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${ie(t)}.
Url: ${Hr(t)}`),!0)}s(oc,"_shouldDropEvent");function cc(t,e){return!e||!e.length?!1:pc(t).some(r=>e.some(n=>Ce(r,n)))}s(cc,"_isIgnoredError");function uc(t,e){if(!e||!e.length)return!1;var r=Hr(t);return r?e.some(n=>Ce(r,n)):!1}s(uc,"_isDeniedUrl");function dc(t,e){if(!e||!e.length)return!0;var r=Hr(t);return r?e.some(n=>Ce(r,n)):!0}s(dc,"_isAllowedUrl");function pc(t){if(t.message)return[t.message];if(t.exception)try{let{type:e="",value:r=""}=t.exception.values&&t.exception.values[0]||{};return[`${r}`,`${e}: ${r}`]}catch{return(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.error(`Cannot extract message for event ${ie(t)}`),[]}return[]}s(pc,"_getPossibleEventMessages");function fc(t){try{return t.exception.values[0].type==="SentryError"}catch{}return!1}s(fc,"_isSentryError");function lc(t=[]){for(let r=t.length-1;r>=0;r--){var e=t[r];if(e&&e.filename!=="<anonymous>"&&e.filename!=="[native code]")return e.filename||null}return null}s(lc,"_getLastValidUrl");function Hr(t){try{let e;try{e=t.exception.values[0].stacktrace.frames}catch{}return e?lc(e):null}catch{return(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.error(`Cannot extract url for event ${ie(t)}`),null}}s(Hr,"_getEventFilterUrl");function vi(t,e){var r=Si(t,e),n={type:e&&e.name,value:vc(e)};return r.length&&(n.stacktrace={frames:r}),n.type===void 0&&n.value===""&&(n.value="Unrecoverable error caught"),n}s(vi,"exceptionFromError");function hc(t,e,r,n){var i={exception:{values:[{type:dt(e)?e.constructor.name:n?"UnhandledRejection":"Error",value:`Non-Error ${n?"promise rejection":"exception"} captured with keys: ${Yn(e)}`}]},extra:{__serialized__:Ur(e)}};if(r){var a=Si(t,r);a.length&&(i.exception.values[0].stacktrace={frames:a})}return i}s(hc,"eventFromPlainObject");function gi(t,e){return{exception:{values:[vi(t,e)]}}}s(gi,"eventFromError");function Si(t,e){var r=e.stacktrace||e.stack||"",n=_c(e);try{return t(r,n)}catch{}return[]}s(Si,"parseStackFrames");var gc=/Minified React error #\d+;/i;function _c(t){if(t){if(typeof t.framesToPop=="number")return t.framesToPop;if(gc.test(t.message))return 1}return 0}s(_c,"getPopSize");function vc(t){var e=t&&t.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:e:"No error message"}s(vc,"extractMessage");function os(t,e,r,n){var i=r&&r.syntheticException||void 0,a=qr(t,e,i,n);return he(a),a.level="error",r&&r.event_id&&(a.event_id=r.event_id),G(a)}s(os,"eventFromException");function cs(t,e,r="info",n,i){var a=n&&n.syntheticException||void 0,o=_i(t,e,a,i);return o.level=r,n&&n.event_id&&(o.event_id=n.event_id),G(o)}s(cs,"eventFromMessage");function qr(t,e,r,n,i){let a;if(Bt(e)&&e.error){var o=e;return gi(t,o.error)}if(kr(e)||An(e)){var c=e;if("stack"in e)a=gi(t,e);else{var u=c.name||(kr(c)?"DOMError":"DOMException"),d=c.message?`${u}: ${c.message}`:u;a=_i(t,d,r,n),mt(a,d)}return"code"in c&&(a.tags={...a.tags,"DOMException.code":`${c.code}`}),a}if(Gt(e))return gi(t,e);if(W(e)||dt(e)){var p=e;return a=hc(t,p,r,i),he(a,{synthetic:!0}),a}return a=_i(t,e,r,n),mt(a,`${e}`,void 0),he(a,{synthetic:!0}),a}s(qr,"eventFromUnknownInput");function _i(t,e,r,n){var i={message:e};if(n&&r){var a=Si(t,r);a.length&&(i.exception={values:[{value:e,stacktrace:{frames:a}}]})}return i}s(_i,"eventFromString");var Ti="Breadcrumbs",ee=class{static __initStatic(){this.id=Ti}__init(){this.name=ee.id}constructor(e){ee.prototype.__init.call(this),this.options={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...e}}setupOnce(){this.options.console&&x("console",Tc),this.options.dom&&x("dom",Sc(this.options.dom)),this.options.xhr&&x("xhr",yc),this.options.fetch&&x("fetch",Ec),this.options.history&&x("history",bc)}};s(ee,"Breadcrumbs");ee.__initStatic();function Sc(t){function e(r){let n,i=typeof t=="object"?t.serializeAttribute:void 0;typeof i=="string"&&(i=[i]);try{n=r.event.target?me(r.event.target,i):me(r.event,i)}catch{n="<unknown>"}n.length!==0&&S().addBreadcrumb({category:`ui.${r.name}`,message:n},{event:r.event,name:r.name,global:r.global})}return s(e,"_innerDomBreadcrumb"),e}s(Sc,"_domBreadcrumb");function Tc(t){var e={category:"console",data:{arguments:t.args,logger:"console"},level:Qn(t.level),message:Pr(t.args," ")};if(t.level==="assert")if(t.args[0]===!1)e.message=`Assertion failed: ${Pr(t.args.slice(1)," ")||"console.assert"}`,e.data.arguments=t.args.slice(1);else return;S().addBreadcrumb(e,{input:t.args,level:t.level})}s(Tc,"_consoleBreadcrumb");function yc(t){if(t.endTimestamp){if(t.xhr.__sentry_own_request__)return;let{method:e,url:r,status_code:n,body:i}=t.xhr.__sentry_xhr__||{};S().addBreadcrumb({category:"xhr",data:{method:e,url:r,status_code:n},type:"http"},{xhr:t.xhr,input:i});return}}s(yc,"_xhrBreadcrumb");function Ec(t){!t.endTimestamp||t.fetchData.url.match(/sentry_key/)&&t.fetchData.method==="POST"||(t.error?S().addBreadcrumb({category:"fetch",data:t.fetchData,level:"error",type:"http"},{data:t.error,input:t.args}):S().addBreadcrumb({category:"fetch",data:{...t.fetchData,status_code:t.response.status},type:"http"},{input:t.args,response:t.response}))}s(Ec,"_fetchBreadcrumb");function bc(t){var e=_();let r=t.from,n=t.to;var i=Yt(e.location.href);let a=Yt(r);var o=Yt(n);a.path||(a=i),i.protocol===o.protocol&&i.host===o.host&&(n=o.relative),i.protocol===a.protocol&&i.host===a.host&&(r=a.relative),S().addBreadcrumb({category:"navigation",data:{from:r,to:n}})}s(bc,"_historyBreadcrumb");var te=_(),zr;function yi(){if(zr)return zr;if(Ft(te.fetch))return zr=te.fetch.bind(te);var t=te.document;let e=te.fetch;if(t&&typeof t.createElement=="function")try{var r=t.createElement("iframe");r.hidden=!0,t.head.appendChild(r);var n=r.contentWindow;n&&n.fetch&&(e=n.fetch),t.head.removeChild(r)}catch(i){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",i)}return zr=e.bind(te)}s(yi,"getNativeFetchImplementation");function us(t,e){var r=Object.prototype.toString.call(te&&te.navigator)==="[object Navigator]",n=r&&typeof te.navigator.sendBeacon=="function";if(n){var i=te.navigator.sendBeacon.bind(te.navigator);i(t,e)}else if(lt()){var a=yi();a(t,{body:e,method:"POST",credentials:"omit",keepalive:!0}).then(null,o=>{(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.error(o)})}}s(us,"sendReport");var Ei=_(),Qt=class extends Q{constructor(e){e._metadata=e._metadata||{},e._metadata.sdk=e._metadata.sdk||{name:"sentry.javascript.browser",packages:[{name:"npm:@sentry/browser",version:Xt}],version:Xt},super(e),e.sendClientReports&&Ei.document&&Ei.document.addEventListener("visibilitychange",()=>{Ei.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(e,r){return os(this._options.stackParser,e,r,this._options.attachStacktrace)}eventFromMessage(e,r="info",n){return cs(this._options.stackParser,e,r,n,this._options.attachStacktrace)}sendEvent(e,r){var n=this.getIntegrationById(Ti);n&&n.options&&n.options.sentry&&S().addBreadcrumb({category:`sentry.${e.type==="transaction"?"transaction":"event"}`,event_id:e.event_id,level:e.level,message:ie(e)},{event:e}),super.sendEvent(e,r)}_prepareEvent(e,r,n){return e.platform=e.platform||"javascript",super._prepareEvent(e,r,n)}_flushOutcomes(){var e=this._clearOutcomes();if(e.length===0){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("No outcomes to send");return}if(!this._dsn){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("No dsn provided, will not send outcomes");return}(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("Sending outcomes:",e);var r=Kt(this._dsn,this._options.tunnel),n=ai(e,this._options.tunnel&&we(this._dsn));try{us(r,qt(n))}catch(i){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.error(i)}}};s(Qt,"BrowserClient");function ds(t,e=yi()){function r(n){var i={body:n.body,method:"POST",referrerPolicy:"origin",headers:t.headers,...t.fetchOptions};return e(t.url,i).then(a=>({statusCode:a.status,headers:{"x-sentry-rate-limits":a.headers.get("X-Sentry-Rate-Limits"),"retry-after":a.headers.get("Retry-After")}}))}return s(r,"makeRequest"),_t(t,r)}s(ds,"makeFetchTransport");var Rc=4;function ps(t){function e(r){return new k((n,i)=>{var a=new XMLHttpRequest;a.onerror=i,a.onreadystatechange=()=>{a.readyState===Rc&&n({statusCode:a.status,headers:{"x-sentry-rate-limits":a.getResponseHeader("X-Sentry-Rate-Limits"),"retry-after":a.getResponseHeader("Retry-After")}})},a.open("POST",t.url);for(var o in t.headers)Object.prototype.hasOwnProperty.call(t.headers,o)&&a.setRequestHeader(o,t.headers[o]);a.send(r.body)})}return s(e,"makeRequest"),_t(t,e)}s(ps,"makeXHRTransport");var Vr="?";var kc=30,Cc=40,xc=50;function bi(t,e,r,n){var i={filename:t,function:e,in_app:!0};return r!==void 0&&(i.lineno=r),n!==void 0&&(i.colno=n),i}s(bi,"createFrame");var Pc=/^\s*at (?:(.*?) ?\((?:address at )?)?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Ic=/\((\S*)(?::(\d+))(?::(\d+))\)/,Dc=s(t=>{var e=Pc.exec(t);if(e){var r=e[2]&&e[2].indexOf("eval")===0;if(r){var n=Ic.exec(e[2]);n&&(e[2]=n[1],e[3]=n[2],e[4]=n[3])}let[i,a]=ls(e[1]||Vr,e[2]);return bi(a,i,e[3]?+e[3]:void 0,e[4]?+e[4]:void 0)}},"chrome"),Oc=[kc,Dc],Mc=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension|capacitor).*?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,Nc=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,Lc=s(t=>{var e=Mc.exec(t);if(e){var r=e[3]&&e[3].indexOf(" > eval")>-1;if(r){var n=Nc.exec(e[3]);n&&(e[1]=e[1]||"eval",e[3]=n[1],e[4]=n[2],e[5]="")}let i=e[3],a=e[1]||Vr;return[a,i]=ls(a,i),bi(i,a,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}},"gecko"),Ac=[xc,Lc],Uc=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,Gc=s(t=>{var e=Uc.exec(t);return e?bi(e[2],e[1]||Vr,+e[3],e[4]?+e[4]:void 0):void 0},"winjs"),Bc=[Cc,Gc];var jc=[Oc,Ac,Bc],fs=Or(...jc),ls=s((t,e)=>{var r=t.indexOf("safari-extension")!==-1,n=t.indexOf("safari-web-extension")!==-1;return r||n?[t.indexOf("@")!==-1?t.split("@")[0]:Vr,r?`safari-extension:${e}`:`safari-web-extension:${e}`]:[t,e]},"extractSafariExtensionDetails");var Ri=0;function ki(){return Ri>0}s(ki,"shouldIgnoreOnError");function Fc(){Ri+=1,setTimeout(()=>{Ri-=1})}s(Fc,"ignoreNextOnError");function ze(t,e={},r){if(typeof t!="function")return t;try{var n=t.__sentry_wrapped__;if(n)return n;if(Ye(t))return t}catch{return t}var i=s(function(){var c=Array.prototype.slice.call(arguments);try{r&&typeof r=="function"&&r.apply(this,arguments);var u=c.map(d=>ze(d,e));return t.apply(this,u)}catch(d){throw Fc(),Jt(p=>{p.addEventProcessor(f=>(e.mechanism&&(mt(f,void 0,void 0),he(f,e.mechanism)),f.extra={...f.extra,arguments:c},f)),Wt(d)}),d}},"sentryWrapped");try{for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(i[a]=t[a])}catch{}Ir(i,t),ft(t,"__sentry_wrapped__",i);try{var o=Object.getOwnPropertyDescriptor(i,"name");o.configurable&&Object.defineProperty(i,"name",{get(){return t.name}})}catch{}return i}s(ze,"wrap");var Ci={};Xe(Ci,{Breadcrumbs:()=>ee,Dedupe:()=>Y,GlobalHandlers:()=>N,HttpContext:()=>w,LinkedErrors:()=>F,TryCatch:()=>re});var N=class{static __initStatic(){this.id="GlobalHandlers"}__init(){this.name=N.id}__init2(){this._installFunc={onerror:wc,onunhandledrejection:Yc}}constructor(e){N.prototype.__init.call(this),N.prototype.__init2.call(this),this._options={onerror:!0,onunhandledrejection:!0,...e}}setupOnce(){Error.stackTraceLimit=50;var e=this._options;for(var r in e){var n=this._installFunc[r];n&&e[r]&&(qc(r),n(),this._installFunc[r]=void 0)}}};s(N,"GlobalHandlers");N.__initStatic();function wc(){x("error",t=>{let[e,r,n]=gs();if(!e.getIntegration(N))return;let{msg:i,url:a,line:o,column:c,error:u}=t;if(!(ki()||u&&u.__sentry_own_request__)){var d=u===void 0&&V(i)?Hc(i,a,o,c):ms(qr(r,u||i,void 0,n,!1),a,o,c);d.level="error",hs(e,u,d,"onerror")}})}s(wc,"_installGlobalOnErrorHandler");function Yc(){x("unhandledrejection",t=>{let[e,r,n]=gs();if(!e.getIntegration(N))return;let i=t;try{"reason"in t?i=t.reason:"detail"in t&&"reason"in t.detail&&(i=t.detail.reason)}catch{}if(ki()||i&&i.__sentry_own_request__)return!0;var a=ut(i)?$c(i):qr(r,i,void 0,n,!0);a.level="error",hs(e,i,a,"onunhandledrejection")})}s(Yc,"_installGlobalOnUnhandledRejectionHandler");function $c(t){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(t)}`}]}}}s($c,"_eventFromRejectionWithPrimitive");function Hc(t,e,r,n){var i=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i;let a=Bt(t)?t.message:t,o="Error";var c=a.match(i);c&&(o=c[1],a=c[2]);var u={exception:{values:[{type:o,value:a}]}};return ms(u,e,r,n)}s(Hc,"_eventFromIncompleteOnError");function ms(t,e,r,n){var i=t.exception=t.exception||{},a=i.values=i.values||[],o=a[0]=a[0]||{},c=o.stacktrace=o.stacktrace||{},u=c.frames=c.frames||[],d=isNaN(parseInt(n,10))?void 0:n,p=isNaN(parseInt(r,10))?void 0:r,f=V(e)&&e.length>0?e:jn();return u.length===0&&u.push({colno:d,filename:f,function:"?",in_app:!0,lineno:p}),t}s(ms,"_enhanceEventWithInitialFrame");function qc(t){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`Global Handler attached: ${t}`)}s(qc,"globalHandlerLog");function hs(t,e,r,n){he(r,{handled:!1,type:n}),t.captureEvent(r,{originalException:e})}s(hs,"addMechanismAndCapture");function gs(){var t=S(),e=t.getClient(),r=e&&e.getOptions()||{stackParser:()=>[],attachStacktrace:!1};return[t,r.stackParser,r.attachStacktrace]}s(gs,"getHubAndOptions");var zc=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],re=class{static __initStatic(){this.id="TryCatch"}__init(){this.name=re.id}constructor(e){re.prototype.__init.call(this),this._options={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...e}}setupOnce(){var e=_();this._options.setTimeout&&P(e,"setTimeout",_s),this._options.setInterval&&P(e,"setInterval",_s),this._options.requestAnimationFrame&&P(e,"requestAnimationFrame",Vc),this._options.XMLHttpRequest&&"XMLHttpRequest"in e&&P(XMLHttpRequest.prototype,"send",Wc);var r=this._options.eventTarget;if(r){var n=Array.isArray(r)?r:zc;n.forEach(Jc)}}};s(re,"TryCatch");re.__initStatic();function _s(t){return function(...e){var r=e[0];return e[0]=ze(r,{mechanism:{data:{function:j(t)},handled:!0,type:"instrument"}}),t.apply(this,e)}}s(_s,"_wrapTimeFunction");function Vc(t){return function(e){return t.apply(this,[ze(e,{mechanism:{data:{function:"requestAnimationFrame",handler:j(t)},handled:!0,type:"instrument"}})])}}s(Vc,"_wrapRAF");function Wc(t){return function(...e){var r=this,n=["onload","onerror","onprogress","onreadystatechange"];return n.forEach(i=>{i in r&&typeof r[i]=="function"&&P(r,i,function(a){var o={mechanism:{data:{function:i,handler:j(a)},handled:!0,type:"instrument"}},c=Ye(a);return c&&(o.mechanism.data.handler=j(c)),ze(a,o)})}),t.apply(this,e)}}s(Wc,"_wrapXHR");function Jc(t){var e=_(),r=e[t]&&e[t].prototype;!r||!r.hasOwnProperty||!r.hasOwnProperty("addEventListener")||(P(r,"addEventListener",function(n){return function(i,a,o){try{typeof a.handleEvent=="function"&&(a.handleEvent=ze(a.handleEvent,{mechanism:{data:{function:"handleEvent",handler:j(a),target:t},handled:!0,type:"instrument"}}))}catch{}return n.apply(this,[i,ze(a,{mechanism:{data:{function:"addEventListener",handler:j(a),target:t},handled:!0,type:"instrument"}}),o])}}),P(r,"removeEventListener",function(n){return function(i,a,o){var c=a;try{var u=c&&c.__sentry_wrapped__;u&&n.call(this,i,u,o)}catch{}return n.call(this,i,c,o)}}))}s(Jc,"_wrapEventTarget");var Kc="cause",Xc=5,F=class{static __initStatic(){this.id="LinkedErrors"}__init(){this.name=F.id}constructor(e={}){F.prototype.__init.call(this),this._key=e.key||Kc,this._limit=e.limit||Xc}setupOnce(){var e=S().getClient();!e||Se((r,n)=>{var i=S().getIntegration(F);return i?Qc(e.getOptions().stackParser,i._key,i._limit,r,n):r})}};s(F,"LinkedErrors");F.__initStatic();function Qc(t,e,r,n,i){if(!n.exception||!n.exception.values||!i||!M(i.originalException,Error))return n;var a=vs(t,r,i.originalException,e);return n.exception.values=[...a,...n.exception.values],n}s(Qc,"_handler");function vs(t,e,r,n,i=[]){if(!M(r[n],Error)||i.length+1>=e)return i;var a=vi(t,r[n]);return vs(t,e,r[n],n,[a,...i])}s(vs,"_walkErrorTree");var Ve=_(),w=class{constructor(){w.prototype.__init.call(this)}static __initStatic(){this.id="HttpContext"}__init(){this.name=w.id}setupOnce(){Se(e=>{if(S().getIntegration(w)){if(!Ve.navigator&&!Ve.location&&!Ve.document)return e;var r=e.request&&e.request.url||Ve.location&&Ve.location.href;let{referrer:a}=Ve.document||{},{userAgent:o}=Ve.navigator||{};var n={...e.request&&e.request.headers,...a&&{Referer:a},...o&&{"User-Agent":o}},i={...r&&{url:r},headers:n};return{...e,request:i}}return e})}};s(w,"HttpContext");w.__initStatic();var Y=class{constructor(){Y.prototype.__init.call(this)}static __initStatic(){this.id="Dedupe"}__init(){this.name=Y.id}setupOnce(e,r){var n=s(i=>{var a=r().getIntegration(Y);if(a){try{if(Zc(i,a._previousEvent))return(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{return a._previousEvent=i}return a._previousEvent=i}return i},"eventProcessor");n.id=this.name,e(n)}};s(Y,"Dedupe");Y.__initStatic();function Zc(t,e){return e?!!(eu(t,e)||tu(t,e)):!1}s(Zc,"_shouldDropEvent");function eu(t,e){var r=t.message,n=e.message;return!(!r&&!n||r&&!n||!r&&n||r!==n||!Es(t,e)||!ys(t,e))}s(eu,"_isSameMessageEvent");function tu(t,e){var r=Ss(e),n=Ss(t);return!(!r||!n||r.type!==n.type||r.value!==n.value||!Es(t,e)||!ys(t,e))}s(tu,"_isSameExceptionEvent");function ys(t,e){let r=Ts(t),n=Ts(e);if(!r&&!n)return!0;if(r&&!n||!r&&n||(r=r,n=n,n.length!==r.length))return!1;for(let o=0;o<n.length;o++){var i=n[o],a=r[o];if(i.filename!==a.filename||i.lineno!==a.lineno||i.colno!==a.colno||i.function!==a.function)return!1}return!0}s(ys,"_isSameStacktrace");function Es(t,e){let r=t.fingerprint,n=e.fingerprint;if(!r&&!n)return!0;if(r&&!n||!r&&n)return!1;r=r,n=n;try{return r.join("")===n.join("")}catch{return!1}}s(Es,"_isSameFingerprint");function Ss(t){return t.exception&&t.exception.values&&t.exception.values[0]}s(Ss,"_getExceptionFromEvent");function Ts(t){var e=t.exception;if(e)try{return e.values[0].stacktrace.frames}catch{return}}s(Ts,"_getFramesFromEvent");var Rs=[new qe.InboundFilters,new qe.FunctionToString,new re,new ee,new N,new F,new Y,new w];function xi(t={}){if(t.defaultIntegrations===void 0&&(t.defaultIntegrations=Rs),t.release===void 0){var e=_();e.SENTRY_RELEASE&&e.SENTRY_RELEASE.id&&(t.release=e.SENTRY_RELEASE.id)}t.autoSessionTracking===void 0&&(t.autoSessionTracking=!0),t.sendClientReports===void 0&&(t.sendClientReports=!0);var r={...t,stackParser:Hn(t.stackParser||fs),integrations:mi(t),transport:t.transport||(lt()?ds:ps)};hi(Qt,r),t.autoSessionTracking&&ru()}s(xi,"init");function bs(t){t.startSession({ignoreDuration:!0}),t.captureSession()}s(bs,"startSessionOnHub");function ru(){var t=_(),e=t.document;if(typeof e=="undefined"){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn("Session tracking in non-browser environment with @sentry/browser is not supported.");return}var r=S();!r.captureSession||(bs(r),x("history",({from:n,to:i})=>{n===void 0||n===i||bs(S())}))}s(ru,"startSessionTracking");var ks={},Pi=_();Pi.Sentry&&Pi.Sentry.Integrations&&(ks=Pi.Sentry.Integrations);var Th={...ks,...qe,...Ci};function Zt(t){var e=S().getClient(),r=t||e&&e.getOptions();return!!r&&("tracesSampleRate"in r||"tracesSampler"in r)}s(Zt,"hasTracingEnabled");function We(t){var e=t||S(),r=e.getScope();return r&&r.getTransaction()}s(We,"getActiveTransaction");function I(t){return t/1e3}s(I,"msToSec");function xs(){x("error",Cs),x("unhandledrejection",Cs)}s(xs,"registerErrorInstrumentation");function Cs(){var t=We();if(t){var e="internal_error";(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Transaction: ${e} -> Global error occured`),t.setStatus(e)}}s(Cs,"errorCallback");var Te=class{__init(){this.spans=[]}constructor(e=1e3){Te.prototype.__init.call(this),this._maxlen=e}add(e){this.spans.length>this._maxlen?e.spanRecorder=void 0:this.spans.push(e)}};s(Te,"SpanRecorder");var $=class{__init2(){this.traceId=U()}__init3(){this.spanId=U().substring(16)}__init4(){this.startTimestamp=xe()}__init5(){this.tags={}}__init6(){this.data={}}constructor(e){if($.prototype.__init2.call(this),$.prototype.__init3.call(this),$.prototype.__init4.call(this),$.prototype.__init5.call(this),$.prototype.__init6.call(this),!e)return this;e.traceId&&(this.traceId=e.traceId),e.spanId&&(this.spanId=e.spanId),e.parentSpanId&&(this.parentSpanId=e.parentSpanId),"sampled"in e&&(this.sampled=e.sampled),e.op&&(this.op=e.op),e.description&&(this.description=e.description),e.data&&(this.data=e.data),e.tags&&(this.tags=e.tags),e.status&&(this.status=e.status),e.startTimestamp&&(this.startTimestamp=e.startTimestamp),e.endTimestamp&&(this.endTimestamp=e.endTimestamp)}startChild(e){var r=new $({...e,parentSpanId:this.spanId,sampled:this.sampled,traceId:this.traceId});return r.spanRecorder=this.spanRecorder,r.spanRecorder&&r.spanRecorder.add(r),r.transaction=this.transaction,r}setTag(e,r){return this.tags={...this.tags,[e]:r},this}setData(e,r){return this.data={...this.data,[e]:r},this}setStatus(e){return this.status=e,this}setHttpStatus(e){this.setTag("http.status_code",String(e));var r=iu(e);return r!=="unknown_error"&&this.setStatus(r),this}isSuccess(){return this.status==="ok"}finish(e){this.endTimestamp=typeof e=="number"?e:xe()}toTraceparent(){let e="";return this.sampled!==void 0&&(e=this.sampled?"-1":"-0"),`${this.traceId}-${this.spanId}${e}`}toContext(){return A({data:this.data,description:this.description,endTimestamp:this.endTimestamp,op:this.op,parentSpanId:this.parentSpanId,sampled:this.sampled,spanId:this.spanId,startTimestamp:this.startTimestamp,status:this.status,tags:this.tags,traceId:this.traceId})}updateWithContext(e){return this.data=B(e.data,()=>({})),this.description=e.description,this.endTimestamp=e.endTimestamp,this.op=e.op,this.parentSpanId=e.parentSpanId,this.sampled=e.sampled,this.spanId=B(e.spanId,()=>this.spanId),this.startTimestamp=B(e.startTimestamp,()=>this.startTimestamp),this.status=e.status,this.tags=B(e.tags,()=>({})),this.traceId=B(e.traceId,()=>this.traceId),this}getTraceContext(){return A({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,trace_id:this.traceId})}getBaggage(){var e=this.transaction&&this.transaction.metadata.baggage,r=!e||wr(e)&&zt(e)?this._getBaggageWithSentryValues(e):e;return r}toJSON(){return A({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,start_timestamp:this.startTimestamp,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this.endTimestamp,trace_id:this.traceId})}_getBaggageWithSentryValues(e=jr({})){var r=this.transaction&&this.transaction._hub||S(),n=r.getClient();let{environment:i,release:a}=n&&n.getOptions()||{};return i&&Fr(e,"environment",i),a&&Fr(e,"release",a),Yr(e),e}};s($,"Span");function iu(t){if(t<400&&t>=100)return"ok";if(t>=400&&t<500)switch(t){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(t>=500&&t<600)switch(t){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}s(iu,"spanStatusfromHttpCode");var ye=class extends ${__init(){this._measurements={}}constructor(e,r){super(e),ye.prototype.__init.call(this),this._hub=r||S(),this.name=e.name||"",this.metadata=e.metadata||{},this._trimEnd=e.trimEnd,this.transaction=this}setName(e){this.name=e}initSpanRecorder(e=1e3){this.spanRecorder||(this.spanRecorder=new Te(e)),this.spanRecorder.add(this)}setMeasurement(e,r,n=""){this._measurements[e]={value:r,unit:n}}setMetadata(e){this.metadata={...this.metadata,...e}}finish(e){if(this.endTimestamp===void 0){if(this.name||((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),super.finish(e),this.sampled!==!0){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled.");var r=this._hub.getClient();r&&r.recordDroppedEvent("sample_rate","transaction");return}var n=this.spanRecorder?this.spanRecorder.spans.filter(o=>o!==this&&o.endTimestamp):[];this._trimEnd&&n.length>0&&(this.endTimestamp=n.reduce((o,c)=>o.endTimestamp&&c.endTimestamp?o.endTimestamp>c.endTimestamp?o:c:o).endTimestamp);var i={contexts:{trace:this.getTraceContext(),baggage:ci(this.getBaggage())},spans:n,start_timestamp:this.startTimestamp,tags:this.tags,timestamp:this.endTimestamp,transaction:this.name,type:"transaction",sdkProcessingMetadata:this.metadata},a=Object.keys(this._measurements).length>0;return a&&((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),i.measurements=this._measurements),(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Finishing ${this.op} transaction: ${this.name}.`),this._hub.captureEvent(i)}}toContext(){var e=super.toContext();return A({...e,name:this.name,trimEnd:this._trimEnd})}updateWithContext(e){return super.updateWithContext(e),this.name=B(e.name,()=>""),this._trimEnd=e.trimEnd,this}};s(ye,"Transaction");var Ii=1e3,Di=3e4,au=5e3,Wr=class extends Te{constructor(e,r,n,i){super(i),this._pushActivity=e,this._popActivity=r,this.transactionSpanId=n}add(e){e.spanId!==this.transactionSpanId&&(e.finish=r=>{e.endTimestamp=typeof r=="number"?r:xe(),this._popActivity(e.spanId)},e.endTimestamp===void 0&&this._pushActivity(e.spanId)),super.add(e)}};s(Wr,"IdleTransactionSpanRecorder");var oe=class extends ye{__init(){this.activities={}}__init2(){this._heartbeatCounter=0}__init3(){this._finished=!1}__init4(){this._beforeFinishCallbacks=[]}constructor(e,r,n=Ii,i=Di,a=!1){super(e,r),this._idleHub=r,this._idleTimeout=n,this._finalTimeout=i,this._onScope=a,oe.prototype.__init.call(this),oe.prototype.__init2.call(this),oe.prototype.__init3.call(this),oe.prototype.__init4.call(this),a&&(Ps(r),(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`Setting idle transaction on scope. Span ID: ${this.spanId}`),r.configureScope(o=>o.setSpan(this))),this._startIdleTimeout(),setTimeout(()=>{this._finished||(this.setStatus("deadline_exceeded"),this.finish())},this._finalTimeout)}finish(e=xe()){if(this._finished=!0,this.activities={},this.spanRecorder){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Tracing] finishing IdleTransaction",new Date(e*1e3).toISOString(),this.op);for(var r of this._beforeFinishCallbacks)r(this,e);this.spanRecorder.spans=this.spanRecorder.spans.filter(n=>{if(n.spanId===this.spanId)return!0;n.endTimestamp||(n.endTimestamp=e,n.setStatus("cancelled"),(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(n,void 0,2)));var i=n.startTimestamp<e;return i||(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Tracing] discarding Span since it happened after Transaction was finished",JSON.stringify(n,void 0,2)),i}),(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Tracing] flushing IdleTransaction")}else(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Tracing] No active IdleTransaction");return this._onScope&&Ps(this._idleHub),super.finish(e)}registerBeforeFinishCallback(e){this._beforeFinishCallbacks.push(e)}initSpanRecorder(e){if(!this.spanRecorder){var r=s(i=>{this._finished||this._pushActivity(i)},"pushActivity"),n=s(i=>{this._finished||this._popActivity(i)},"popActivity");this.spanRecorder=new Wr(r,n,this.spanId,e),(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)}_cancelIdleTimeout(){this._idleTimeoutID&&(clearTimeout(this._idleTimeoutID),this._idleTimeoutID=void 0)}_startIdleTimeout(e){this._cancelIdleTimeout(),this._idleTimeoutID=setTimeout(()=>{!this._finished&&Object.keys(this.activities).length===0&&this.finish(e)},this._idleTimeout)}_pushActivity(e){this._cancelIdleTimeout(),(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`[Tracing] pushActivity: ${e}`),this.activities[e]=!0,(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Tracing] new activities count",Object.keys(this.activities).length)}_popActivity(e){if(this.activities[e]&&((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`[Tracing] popActivity ${e}`),delete this.activities[e],(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Tracing] new activities count",Object.keys(this.activities).length)),Object.keys(this.activities).length===0){var r=xe()+this._idleTimeout/1e3;this._startIdleTimeout(r)}}_beat(){if(!this._finished){var e=Object.keys(this.activities).join("");e===this._prevHeartbeatString?this._heartbeatCounter+=1:this._heartbeatCounter=1,this._prevHeartbeatString=e,this._heartbeatCounter>=3?((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus("deadline_exceeded"),this.finish()):this._pingHeartbeat()}}_pingHeartbeat(){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`pinging Heartbeat -> current counter: ${this._heartbeatCounter}`),setTimeout(()=>{this._beat()},au)}};s(oe,"IdleTransaction");function Ps(t){var e=t.getScope();if(e){var r=e.getTransaction();r&&e.setSpan(void 0)}}s(Ps,"clearActiveTransaction");function su(){var t=this.getScope();if(t){var e=t.getSpan();if(e)return{"sentry-trace":e.toTraceparent()}}return{}}s(su,"traceHeaders");function Is(t,e,r){if(!Zt(e))return t.sampled=!1,t;if(t.sampled!==void 0)return t.setMetadata({transactionSampling:{method:"explicitly_set"}}),t;let n;return typeof e.tracesSampler=="function"?(n=e.tracesSampler(r),t.setMetadata({transactionSampling:{method:"client_sampler",rate:Number(n)}})):r.parentSampled!==void 0?(n=r.parentSampled,t.setMetadata({transactionSampling:{method:"inheritance"}})):(n=e.tracesSampleRate,t.setMetadata({transactionSampling:{method:"client_rate",rate:Number(n)}})),ou(n)?n?(t.sampled=Math.random()<n,t.sampled?((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`[Tracing] starting ${t.op} transaction - ${t.name}`),t):((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(n)})`),t)):((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Discarding transaction because ${typeof e.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),t.sampled=!1,t):((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn("[Tracing] Discarding transaction because of invalid sample rate."),t.sampled=!1,t)}s(Is,"sample");function ou(t){return jt(t)||!(typeof t=="number"||typeof t=="boolean")?((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(t)} of type ${JSON.stringify(typeof t)}.`),!1):t<0||t>1?((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${t}.`),!1):!0}s(ou,"isValidSampleRate");function cu(t,e){var r=this.getClient(),n=r&&r.getOptions()||{};let i=new ye(t,this);return i=Is(i,n,{parentSampled:t.parentSampled,transactionContext:t,...e}),i.sampled&&i.initSpanRecorder(n._experiments&&n._experiments.maxSpans),i}s(cu,"_startTransaction");function Ds(t,e,r,n,i,a){var o=t.getClient(),c=o&&o.getOptions()||{};let u=new oe(e,t,r,n,i);return u=Is(u,c,{parentSampled:e.parentSampled,transactionContext:e,...a}),u.sampled&&u.initSpanRecorder(c._experiments&&c._experiments.maxSpans),u}s(Ds,"startIdleTransaction");function uu(){var t=De();!t.__SENTRY__||(t.__SENTRY__.extensions=t.__SENTRY__.extensions||{},t.__SENTRY__.extensions.startTransaction||(t.__SENTRY__.extensions.startTransaction=cu),t.__SENTRY__.extensions.traceHeaders||(t.__SENTRY__.extensions.traceHeaders=su))}s(uu,"_addTracingExtensions");function du(){var t=De();if(!!t.__SENTRY__){var e={mongodb(){var n=z(module,"./integrations/node/mongo");return new n.Mongo},mongoose(){var n=z(module,"./integrations/node/mongo");return new n.Mongo({mongoose:!0})},mysql(){var n=z(module,"./integrations/node/mysql");return new n.Mysql},pg(){var n=z(module,"./integrations/node/postgres");return new n.Postgres}},r=Object.keys(e).filter(n=>!!Ln(n)).map(n=>{try{return e[n]()}catch{return}}).filter(n=>n);r.length>0&&(t.__SENTRY__.integrations=[...t.__SENTRY__.integrations||[],...r])}}s(du,"_autoloadDatabaseIntegrations");function Os(){uu(),le()&&du(),xs()}s(Os,"addExtensionMethods");var Jr=_();function Ms(){Jr&&Jr.document?Jr.document.addEventListener("visibilitychange",()=>{var t=We();if(Jr.document.hidden&&t){var e="cancelled";(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Transaction: ${e} -> since tab moved to the background, op: ${t.op}`),t.status||t.setStatus(e),t.setTag("visibilitychange","document.hidden"),t.finish()}}):(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn("[Tracing] Could not set up background tab detection due to lack of global document")}s(Ms,"registerBackgroundTabDetection");var vt=s((t,e,r)=>{let n;return i=>{e.value>=0&&(i||r)&&(e.delta=e.value-(n||0),(e.delta||n===void 0)&&(n=e.value,t(e)))}},"bindReporter");var Ns=s(()=>`v2-${Date.now()}-${Math.floor(Math.random()*8999999999999)+1e12}`,"generateUniqueID");var St=s((t,e)=>({name:t,value:B(e,()=>-1),delta:0,entries:[],id:Ns()}),"initMetric");var Tt=s((t,e)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){if(t==="first-input"&&!("PerformanceEventTiming"in self))return;var r=new PerformanceObserver(n=>n.getEntries().map(e));return r.observe({type:t,buffered:!0}),r}}catch{}},"observe");var Oe=s((t,e)=>{var r=s(n=>{(n.type==="pagehide"||_().document.visibilityState==="hidden")&&(t(n),e&&(removeEventListener("visibilitychange",r,!0),removeEventListener("pagehide",r,!0)))},"onHiddenOrPageHide");addEventListener("visibilitychange",r,!0),addEventListener("pagehide",r,!0)},"onHidden");var Ls=s((t,e)=>{var r=St("CLS",0);let n,i=0,a=[];var o=s(u=>{if(u&&!u.hadRecentInput){var d=a[0],p=a[a.length-1];i&&a.length!==0&&u.startTime-p.startTime<1e3&&u.startTime-d.startTime<5e3?(i+=u.value,a.push(u)):(i=u.value,a=[u]),i>r.value&&(r.value=i,r.entries=a,n&&n())}},"entryHandler"),c=Tt("layout-shift",o);c&&(n=vt(t,r,e),Oe(()=>{c.takeRecords().map(o),n(!0)}))},"getCLS");var Kr=-1,pu=s(()=>_().document.visibilityState==="hidden"?0:1/0,"initHiddenTime"),fu=s(()=>{Oe(({timeStamp:t})=>{Kr=t},!0)},"trackChanges"),yt=s(()=>(Kr<0&&(Kr=pu(),fu()),{get firstHiddenTime(){return Kr}}),"getVisibilityWatcher");var As=s((t,e)=>{var r=yt(),n=St("FID");let i;var a=s(c=>{i&&c.startTime<r.firstHiddenTime&&(n.value=c.processingStart-c.startTime,n.entries.push(c),i(!0))},"entryHandler"),o=Tt("first-input",a);o&&(i=vt(t,n,e),Oe(()=>{o.takeRecords().map(a),o.disconnect()},!0))},"getFID");var Us={},Gs=s((t,e)=>{var r=yt(),n=St("LCP");let i;var a=s(u=>{var d=u.startTime;d<r.firstHiddenTime&&(n.value=d,n.entries.push(u)),i&&i()},"entryHandler"),o=Tt("largest-contentful-paint",a);if(o){i=vt(t,n,e);var c=s(()=>{Us[n.id]||(o.takeRecords().map(a),o.disconnect(),Us[n.id]=!0,i(!0))},"stopListening");["keydown","click"].forEach(u=>{addEventListener(u,c,{once:!0,capture:!0})}),Oe(c,!0)}},"getLCP");function er(t){return typeof t=="number"&&isFinite(t)}s(er,"isMeasurementValue");function Je(t,{startTimestamp:e,...r}){return e&&t.startTimestamp>e&&(t.startTimestamp=e),t.startChild({startTimestamp:e,...r})}s(Je,"_startChild");var Ke=_();function js(){return Ke&&Ke.addEventListener&&Ke.performance}s(js,"getBrowserPerformanceAPI");var Bs=0,y={},ce,tr;function Fs(t=!1){var e=js();e&&$e&&(e.mark&&Ke.performance.mark("sentry-tracing-init"),lu(),mu(t),hu())}s(Fs,"startTrackingWebVitals");function lu(){Ls(t=>{var e=t.entries.pop();!e||((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding CLS"),y.cls={value:t.value,unit:"millisecond"},tr=e)})}s(lu,"_trackCLS");function mu(t){Gs(e=>{var r=e.entries.pop();if(!!r){var n=I($e),i=I(r.startTime);(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding LCP"),y.lcp={value:e.value,unit:"millisecond"},y["mark.lcp"]={value:n+i,unit:"second"},ce=r}},t)}s(mu,"_trackLCP");function hu(){As(t=>{var e=t.entries.pop();if(!!e){var r=I($e),n=I(e.startTime);(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding FID"),y.fid={value:t.value,unit:"millisecond"},y["mark.fid"]={value:r+n,unit:"second"}}})}s(hu,"_trackFID");function ws(t){var e=js();if(!e||!Ke.performance.getEntries||!$e)return;(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Tracing] Adding & adjusting spans using Performance API");var r=I($e),n=e.getEntries();let i,a;n.slice(Bs).forEach(o=>{var c=I(o.startTime),u=I(o.duration);if(!(t.op==="navigation"&&r+c<t.startTimestamp))switch(o.entryType){case"navigation":{_u(t,o,r),i=r+I(o.responseStart),a=r+I(o.requestStart);break}case"mark":case"paint":case"measure":{var d=gu(t,o,c,u,r),p=yt(),f=o.startTime<p.firstHiddenTime;o.name==="first-paint"&&f&&((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding FP"),y.fp={value:o.startTime,unit:"millisecond"},y["mark.fp"]={value:d,unit:"second"}),o.name==="first-contentful-paint"&&f&&((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding FCP"),y.fcp={value:o.startTime,unit:"millisecond"},y["mark.fcp"]={value:d,unit:"second"});break}case"resource":{var h=o.name.replace(Ke.location.origin,"");Su(t,o,h,c,u,r);break}default:}}),Bs=Math.max(n.length-1,0),Tu(t),t.op==="pageload"&&(typeof i=="number"&&((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding TTFB"),y.ttfb={value:(i-t.startTimestamp)*1e3,unit:"millisecond"},typeof a=="number"&&a<=i&&(y["ttfb.requestTime"]={value:(i-a)*1e3,unit:"second"})),["fcp","fp","lcp"].forEach(o=>{if(!(!y[o]||r>=t.startTimestamp)){var c=y[o].value,u=r+I(c),d=Math.abs((u-t.startTimestamp)*1e3),p=d-c;(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`[Measurements] Normalized ${o} from ${c} to ${d} (${p})`),y[o].value=d}}),y["mark.fid"]&&y.fid&&Je(t,{description:"first input delay",endTimestamp:y["mark.fid"].value+I(y.fid.value),op:"web.vitals",startTimestamp:y["mark.fid"].value}),"fcp"in y||delete y.cls,Object.keys(y).forEach(o=>{t.setMeasurement(o,y[o].value,y[o].unit)}),yu(t)),ce=void 0,tr=void 0,y={}}s(ws,"addPerformanceEntries");function gu(t,e,r,n,i){var a=i+r,o=a+n;return Je(t,{description:e.name,endTimestamp:o,op:e.entryType,startTimestamp:a}),a}s(gu,"_addMeasureSpans");function _u(t,e,r){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(n=>{Xr(t,e,n,r)}),Xr(t,e,"secureConnection",r,"TLS/SSL","connectEnd"),Xr(t,e,"fetch",r,"cache","domainLookupStart"),Xr(t,e,"domainLookup",r,"DNS"),vu(t,e,r)}s(_u,"_addNavigationSpans");function Xr(t,e,r,n,i,a){var o=a?e[a]:e[`${r}End`],c=e[`${r}Start`];!c||!o||Je(t,{op:"browser",description:B(i,()=>r),startTimestamp:n+I(c),endTimestamp:n+I(o)})}s(Xr,"_addPerformanceNavigationTiming");function vu(t,e,r){Je(t,{op:"browser",description:"request",startTimestamp:r+I(e.requestStart),endTimestamp:r+I(e.responseEnd)}),Je(t,{op:"browser",description:"response",startTimestamp:r+I(e.responseStart),endTimestamp:r+I(e.responseEnd)})}s(vu,"_addRequest");function Su(t,e,r,n,i,a){if(!(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")){var o={};"transferSize"in e&&(o["Transfer Size"]=e.transferSize),"encodedBodySize"in e&&(o["Encoded Body Size"]=e.encodedBodySize),"decodedBodySize"in e&&(o["Decoded Body Size"]=e.decodedBodySize);var c=a+n,u=c+i;Je(t,{description:r,endTimestamp:u,op:e.initiatorType?`resource.${e.initiatorType}`:"resource",startTimestamp:c,data:o})}}s(Su,"_addResourceSpans");function Tu(t){var e=Ke.navigator;if(!!e){var r=e.connection;r&&(r.effectiveType&&t.setTag("effectiveConnectionType",r.effectiveType),r.type&&t.setTag("connectionType",r.type),er(r.rtt)&&(y["connection.rtt"]={value:r.rtt,unit:"millisecond"}),er(r.downlink)&&(y["connection.downlink"]={value:r.downlink,unit:""})),er(e.deviceMemory)&&t.setTag("deviceMemory",`${e.deviceMemory} GB`),er(e.hardwareConcurrency)&&t.setTag("hardwareConcurrency",String(e.hardwareConcurrency))}}s(Tu,"_trackNavigator");function yu(t){ce&&((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding LCP Data"),ce.element&&t.setTag("lcp.element",me(ce.element)),ce.id&&t.setTag("lcp.id",ce.id),ce.url&&t.setTag("lcp.url",ce.url.trim().slice(0,200)),t.setTag("lcp.size",ce.size)),tr&&tr.sources&&((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding CLS Data"),tr.sources.forEach((e,r)=>t.setTag(`cls.source.${r+1}`,me(e.node))))}s(yu,"_tagMetricInfo");var Eu=["localhost",/^\//],rr={traceFetch:!0,traceXHR:!0,tracingOrigins:Eu};function Ys(t){let{traceFetch:e,traceXHR:r,tracingOrigins:n,shouldCreateSpanForRequest:i}={...rr,...t};var a={},o=s(d=>{if(a[d])return a[d];var p=n;return a[d]=p.some(f=>Ce(d,f))&&!Ce(d,"sentry_key"),a[d]},"defaultShouldCreateSpan");let c=o;typeof i=="function"&&(c=s(d=>o(d)&&i(d),"shouldCreateSpan"));var u={};e&&x("fetch",d=>{bu(d,c,u)}),r&&x("xhr",d=>{ku(d,c,u)})}s(Ys,"instrumentOutgoingRequests");function bu(t,e,r){if(!(!Zt()||!(t.fetchData&&e(t.fetchData.url)))){if(t.endTimestamp){var n=t.fetchData.__span;if(!n)return;var i=r[n];i&&(t.response?i.setHttpStatus(t.response.status):t.error&&i.setStatus("internal_error"),i.finish(),delete r[n]);return}var a=We();if(a){var i=a.startChild({data:{...t.fetchData,type:"fetch"},description:`${t.fetchData.method} ${t.fetchData.url}`,op:"http.client"});t.fetchData.__span=i.spanId,r[i.spanId]=i;var o=t.args[0]=t.args[0],c=t.args[1]=t.args[1]||{};c.headers=Ru(o,i,c)}}}s(bu,"fetchCallback");function Ru(t,e,r){let n=r.headers;M(t,Request)&&(n=t.headers);var i=e.getBaggage();if(n)if(typeof n.append=="function")n.append("sentry-trace",e.toTraceparent()),n.append(Ie,He(i,n.get(Ie)));else if(Array.isArray(n)){let[,a]=n.find(([o,c])=>o===Ie);n=[...n,["sentry-trace",e.toTraceparent()],[Ie,He(i,a)]]}else n={...n,"sentry-trace":e.toTraceparent(),baggage:He(i,n.baggage)};else n={"sentry-trace":e.toTraceparent(),baggage:He(i)};return n}s(Ru,"addTracingHeaders");function ku(t,e,r){if(!(!Zt()||t.xhr&&t.xhr.__sentry_own_request__||!(t.xhr&&t.xhr.__sentry_xhr__&&e(t.xhr.__sentry_xhr__.url)))){var n=t.xhr.__sentry_xhr__;if(t.endTimestamp){var i=t.xhr.__sentry_xhr_span_id__;if(!i)return;var a=r[i];a&&(a.setHttpStatus(n.status_code),a.finish(),delete r[i]);return}var o=We();if(o){var a=o.startChild({data:{...n.data,type:"xhr",method:n.method,url:n.url},description:`${n.method} ${n.url}`,op:"http.client"});if(t.xhr.__sentry_xhr_span_id__=a.spanId,r[t.xhr.__sentry_xhr_span_id__]=a,t.xhr.setRequestHeader)try{t.xhr.setRequestHeader("sentry-trace",a.toTraceparent());var c=t.xhr.getRequestHeader&&t.xhr.getRequestHeader(Ie);t.xhr.setRequestHeader(Ie,He(a.getBaggage(),c))}catch{}}}}s(ku,"xhrCallback");var nr=_();function $s(t,e=!0,r=!0){if(!nr||!nr.location){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn("Could not initialize routing instrumentation due to invalid location");return}let n=nr.location.href,i;e&&(i=t({name:nr.location.pathname,op:"pageload"})),r&&x("history",({to:a,from:o})=>{if(o===void 0&&n&&n.indexOf(a)!==-1){n=void 0;return}o!==a&&(n=void 0,i&&((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Finishing current transaction with op: ${i.op}`),i.finish()),i=t({name:nr.location.pathname,op:"navigation"}))})}s($s,"instrumentRoutingWithDefaults");var qs="BrowserTracing",Cu={idleTimeout:Ii,finalTimeout:Di,markBackgroundTransactions:!0,routingInstrumentation:$s,startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0,...rr},Me=class{__init(){this.name=qs}constructor(e){Me.prototype.__init.call(this);let r=rr.tracingOrigins;e&&(e.tracingOrigins&&Array.isArray(e.tracingOrigins)&&e.tracingOrigins.length!==0?r=e.tracingOrigins:(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&(this._emitOptionsWarning=!0)),this.options={...Cu,...e,tracingOrigins:r};let{_metricOptions:n}=this.options;Fs(n&&n._reportAllChanges)}setupOnce(e,r){this._getCurrentHub=r,this._emitOptionsWarning&&((typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn("[Tracing] You need to define `tracingOrigins` in the options. Set an array of urls or patterns to trace."),(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(`[Tracing] We added a reasonable default for you: ${rr.tracingOrigins}`));let{routingInstrumentation:n,startTransactionOnLocationChange:i,startTransactionOnPageLoad:a,markBackgroundTransactions:o,traceFetch:c,traceXHR:u,tracingOrigins:d,shouldCreateSpanForRequest:p}=this.options;n(f=>this._createRouteTransaction(f),a,i),o&&Ms(),Ys({traceFetch:c,traceXHR:u,tracingOrigins:d,shouldCreateSpanForRequest:p})}_createRouteTransaction(e){if(!this._getCurrentHub){(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.warn(`[Tracing] Did not create ${e.op} transaction because _getCurrentHub is invalid.`);return}let{beforeNavigate:r,idleTimeout:n,finalTimeout:i}=this.options;var a=e.op==="pageload"?xu():void 0,o={...e,...a,trimEnd:!0},c=typeof r=="function"?r(o):o,u=c===void 0?{...o,sampled:!1}:c;u.sampled===!1&&(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Will not send ${u.op} transaction because of beforeNavigate.`),(typeof __SENTRY_DEBUG__=="undefined"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Starting ${u.op} transaction on scope`);var d=this._getCurrentHub();let{location:p}=_();var f=Ds(d,u,n,i,!0,{location:p});return f.registerBeforeFinishCallback(h=>{ws(h),h.setTag("sentry_reportAllChanges",Boolean(this.options._metricOptions&&this.options._metricOptions._reportAllChanges))}),f}};s(Me,"BrowserTracing");function xu(){var t=Hs("sentry-trace"),e=Hs("baggage"),r=t?ti(t):void 0,n=di(e,t);if(r||n)return{...r&&r,...n&&{metadata:{baggage:n}}}}s(xu,"extractTraceDataFromMetaTags");function Hs(t){var e=_();if(e.document&&e.document.querySelector){var r=e.document.querySelector(`meta[name=${t}]`);return r?r.getAttribute("content"):null}else return null}s(Hs,"getMetaContent");(typeof __SENTRY_TRACING__=="undefined"||__SENTRY_TRACING__)&&Os();function zs(t){let r=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(r).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}s(zs,"parseJwt");var H="Space",Qr=class extends Vs.EventEmitter{constructor(r,n){var a,o;super();this.localRole=1;this.activeSpeakers=[];this.setJoinBroadcastState=s(r=>{let n=this.broadcasting!==r;this.broadcasting=r,n&&this.emit("BroadcastStateChanged",this.broadcasting)},"setJoinBroadcastState");this.jwt=r,this.spaceId="",this.participants=new Map,this.broadcasting=!1;let i=zs(this.jwt);if(i!==null){switch(this.spaceId=i.sub||"",i.role){case"subscriber":this.localRole=2}this.participantId=i.participant_id||void 0}xi({dsn:"https://c43e8afa69544c398e4880118f90b033@o43841.ingest.sentry.io/6329092",release:`mux-spaces-sdk-js@${br}`,integrations:[new Me],tracesSampleRate:1}),gt("Participant Info",{participantId:(a=this.participantId)!=null?a:"unknown participant id",spaceId:this.spaceId,role:(o=i.role)!=null?o:"publisher"}),this.manager=new Lt(this.spaceId,this.localRole,n),window.spacesDebugger=new Ut(this)}leave(){var r,n;(r=this.localParticipant)==null||r.getAudioTracks().forEach(({track:i})=>{i.stop()}),(n=this.localParticipant)==null||n.getVideoTracks().forEach(({track:i})=>{i.stop()}),this.manager.close()}async join(){this.manager.on("MediaTrackAdded",(r,n,i)=>{this.onTrack(r,n,i)}),this.manager.client.onParticipantJoined=r=>{g.info(H,"onParticipantJoined",r);let n=new Le(r.connection_id,r.role,r.participant_id);r.tracks.forEach(i=>{let a=new Ae(i);a.subscribe(),Nn(n,a),this.manager.trackIdToConnId.set(a.tid,n.connectionId)}),g.info(H,"participant joined:",n),this.participants.set(n.connectionId,n),this.emit("ParticipantJoined",n)},this.manager.client.onParticipantLeft=r=>{g.info(H,"onParticipantLeft",r);let n=this.participants.get(r.connection_id);n&&(n.removeAllListeners(),this.participants.delete(r.connection_id),Array.from(n.audioTracks.values()).concat(Array.from(n.videoTracks.values())).forEach(i=>{this.emit("ParticipantTrackUnpublished",n,i)}),this.emit("ParticipantLeft",n))},this.manager.client.onTrackAdded=r=>{var i;if(g.info(H,"onTrackAdded",r),this.localParticipant&&((i=this.localParticipant)==null?void 0:i.connectionId)===r.connection_id)return;let n=this.participants.get(r.connection_id);if(n){let a=new Ae(r.track);a.subscribe(),Nn(n,a),this.manager.trackIdToConnId.set(a.tid,n.connectionId),n.emit("TrackPublished",a),this.emit("ParticipantTrackPublished",n,a)}},this.manager.client.onTrackRemoved=r=>{g.info(H,"onTrackRemoved",r);let n=this.participants.get(r.connection_id);if(n){let i=ha(n,r.track.tid);n.emit("TrackUnpublished",i),this.emit("ParticipantTrackUnpublished",n,i),this.manager.trackIdToConnId.delete(r.track.tid)}},this.manager.client.onTrackMute=(r,n)=>{let i=this.participants.get(r);if(!i)throw new Error("Participant not found for track mute event");let a=At(i,n);if(!a)throw new Error("Participant does not have track that was muted");a.muted=!0,this.emit("ParticipantTrackMuted",i,a),i.emit("TrackMuted",a),a.emit("Muted")},this.manager.client.onTrackUnmute=(r,n)=>{let i=this.participants.get(r);if(!i)throw new Error("Participant not found for track unmute event");let a=At(i,n);if(!a)throw new Error("Participant does not have track that was unmuted");a.muted=!1,this.emit("ParticipantTrackUnmuted",i,a),i.emit("TrackUnmuted",a),a.emit("Unmuted")},this.manager.client.onActiveSpeakers=r=>{let n=[],i=r.map(a=>{var u;let o=((u=this.localParticipant)==null?void 0:u.connectionId)===a.connectionId?this.localParticipant:this.participants.get(a.connectionId);if(!o){g.error(H,"Participant not found for active speakers event");return}let c=o instanceof Re?_a(o,a.trackId):At(o,a.trackId);if(!c){g.error(H,"Participant does not have track that was speaking",o);return}return this.activeSpeakers.find(d=>d===a.connectionId)||(this.activeSpeakers.push(a.connectionId),o.emit("StartedSpeaking")),n.push(a.connectionId),{participant:o,track:c}});this.activeSpeakers.forEach(a=>{var o;if(!n.find(c=>c===a)){let c=((o=this.localParticipant)==null?void 0:o.connectionId)===a?this.localParticipant:this.participants.get(a);if(!c){g.error(H,"Participant not found for active speakers event");return}c.emit("StoppedSpeaking")}}),this.activeSpeakers=n,this.emit("ActiveSpeakersChanged",i.filter(a=>a))},this.manager.client.onBroadcastStateUpdate=r=>{this.broadcasting=r===1,this.emit("BroadcastStateChanged",this.broadcasting)};try{let{sessionId:r,connectionId:n,participantId:i,broadcasting:a}=await this.manager.connect(this.jwt);this.sessionId=r,this.participantId=i,this.setJoinBroadcastState(a),this.localParticipant=new Re(this.manager,n,this.localRole,i),gt("Session Info",{sessionId:r})}catch(r){throw r instanceof pe?Er(r):r}return this.manager.client.onClose=r=>{throw this.leave(),new Ot(r)},this.localParticipant}onTrack(r,n,i){g.info(H,"sub.ontrack");let a=this.participants.get(r);if(a){if(!At(a,n)){g.error(H,"participant does not have track publication",a,n);return}}else{g.error(H,"tried to add track for participant that doesnt exist id:",r);return}let o=ga(a,n,i);if(!o){g.error(H,"failed to set remote media track",a,n);return}this.emit("ParticipantTrackSubscribed",a,o)}debug(){var i,a;let r=this.manager.debug(),n;switch(this.localRole){case 2:n="subscriber";break;case 1:n="publisher";break;default:n=`unkown role: ${this.localRole}`}return{participantId:(i=this.participantId)!=null?i:"unknown participant id",sessionId:(a=this.sessionId)!=null?a:"unknown session id",connectionId:r.connectionId,spaceId:r.spaceId,localParticipantRole:n}}};s(Qr,"Space");export{it as ConnectionError,nt as InternalError,rt as JWTError,Re as LocalParticipant,tt as LocalTrack,L as MuxError,_r as ParticipantEvent,It as ParticipantRole,Ue as PublishTrackError,Le as RemoteParticipant,Ae as RemoteTrack,Qr as Space,ua as SpaceEvent,be as Track,vr as TrackEvent,et as TrackKind,Dt as TrackSource,ne as UnpublishTrackError,Ge as UpdateTrackError,Ot as WebsocketError,kd as convertSignalingError,oa as internalToExternalError};
